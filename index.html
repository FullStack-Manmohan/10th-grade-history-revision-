<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Class 10 Complete Study App ‚Ä¢ NCERT QuickLearn (SST + Science + Math)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --muted:#9aa7c7; --text:#e7ecff;
      --accent:#5aa6ff; --accent2:#ffb454; --good:#53d18c; --bad:#ff6b6b;
      --science:#a78bfa; --math:#fb923c; --sst:#3b82f6;
      --border:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --card:#ffffff; --muted:#51607d; --text:#111827;
      --accent:#2563eb; --accent2:#b45309; --good:#15803d; --bad:#b91c1c;
      --science:#7c3aed; --math:#ea580c; --sst:#1d4ed8;
      --border:rgba(17,24,39,.12);
      --shadow: 0 10px 30px rgba(17,24,39,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text); background:radial-gradient(1200px 800px at 15% 10%, rgba(90,166,255,.25), transparent 60%),
      radial-gradient(1000px 700px at 90% 30%, rgba(255,180,84,.18), transparent 60%),
      var(--bg);
      min-height:100vh;
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--bg) 82%, transparent);
      border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:18px 16px;}
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    h1{
      margin:0; font-size:20px; letter-spacing:.2px;
    }
    .sub{color:var(--muted); font-size:13px; margin-top:3px}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    button, .pill, input, select{
      font: inherit;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px; border:1px solid var(--border);
      border-radius:999px; background:color-mix(in oklab, var(--card) 88%, transparent);
      box-shadow: var(--shadow);
    }
    .pill small{color:var(--muted)}
    .btn{
      cursor:pointer; border:1px solid var(--border);
      background:color-mix(in oklab, var(--card) 92%, transparent);
      color:var(--text); padding:9px 12px; border-radius:12px;
      box-shadow: var(--shadow);
      transition: transform .06s ease;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color: color-mix(in oklab, var(--accent) 60%, var(--border));}
    .btn.good{border-color: color-mix(in oklab, var(--good) 60%, var(--border));}
    .btn.bad{border-color: color-mix(in oklab, var(--bad) 60%, var(--border));}
    
    .subject-tabs{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;
      padding-bottom:12px; border-bottom:2px solid var(--border);
    }
    .subject-tab{
      cursor:pointer; padding:12px 20px; border-radius:12px;
      border:2px solid var(--border); background:transparent;
      color:var(--text); font-weight:600; font-size:16px;
      transition: all .2s ease;
    }
    .subject-tab:hover{transform: translateY(-2px)}
    .subject-tab.active{transform: translateY(-2px); box-shadow:var(--shadow)}
    .subject-tab[data-subject="sst"].active{
      background: color-mix(in oklab, var(--sst) 20%, transparent);
      border-color: var(--sst);
    }
    .subject-tab[data-subject="science"].active{
      background: color-mix(in oklab, var(--science) 20%, transparent);
      border-color: var(--science);
    }
    .subject-tab[data-subject="math"].active{
      background: color-mix(in oklab, var(--math) 20%, transparent);
      border-color: var(--math);
    }
    
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:14px;
    }
    .tab{
      cursor:pointer;
      padding:9px 12px; border-radius:999px;
      border:1px solid var(--border);
      background:transparent; color:var(--text);
      opacity:.9;
    }
    .tab.active{
      background: color-mix(in oklab, var(--accent) 18%, transparent);
      border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
      opacity:1;
    }
    main{padding:18px 0 40px;}
    .grid{display:grid; gap:14px;}
    @media(min-width:900px){ .grid.cols2{grid-template-columns: 1.1fr .9fr;} }
    @media(min-width:900px){ .grid.cols3{grid-template-columns: 1fr 1fr 1fr;} }
    .card{
      background: color-mix(in oklab, var(--card) 92%, transparent);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:16px}
    .card h3{margin:12px 0 8px; font-size:14px; color:var(--accent)}
    .muted{color:var(--muted)}
    .kpi{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
    .kpi .box{
      padding:10px 12px; border-radius:14px; border:1px solid var(--border);
      background: color-mix(in oklab, var(--card) 90%, transparent);
      min-width:150px;
    }
    .kpi .big{font-family:var(--mono); font-size:18px}
    
    /* SVG diagrams */
    .diagram{
      background: color-mix(in oklab, var(--card) 95%, transparent);
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      margin:12px 0;
    }
    .diagram svg{max-width:100%; height:auto}
    
    /* Math formulas */
    .formula-box{
      background: color-mix(in oklab, var(--math) 10%, transparent);
      border:2px solid color-mix(in oklab, var(--math) 40%, var(--border));
      border-radius:14px;
      padding:14px;
      margin:12px 0;
      font-family:var(--mono);
      font-size:16px;
    }
    .step{
      padding:10px;
      margin:8px 0;
      border-left:3px solid var(--accent);
      background: color-mix(in oklab, var(--card) 90%, transparent);
      border-radius:8px;
    }
    .step-num{
      display:inline-block;
      background:var(--accent);
      color:var(--bg);
      border-radius:50%;
      width:24px;
      height:24px;
      text-align:center;
      line-height:24px;
      font-weight:bold;
      margin-right:8px;
    }
    
    /* Practice problems */
    .problem{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin:10px 0;
      background: color-mix(in oklab, var(--card) 90%, transparent);
    }
    .problem-input{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      border-radius:8px;
      background:transparent;
      color:var(--text);
      font-family:var(--mono);
      margin:8px 0;
    }
    
    /* Concept maps */
    .concept-map{
      background: color-mix(in oklab, var(--card) 95%, transparent);
      border:1px solid var(--border);
      border-radius:16px;
      padding:20px;
      margin:12px 0;
    }
    .concept-node{
      display:inline-block;
      padding:10px 16px;
      border:2px solid var(--accent);
      border-radius:12px;
      background:color-mix(in oklab, var(--card) 90%, transparent);
      margin:6px;
      font-weight:600;
    }
    .concept-arrow{
      display:inline-block;
      color:var(--accent);
      font-size:20px;
      margin:0 8px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .row > *{flex:0 0 auto}
    input[type="search"], select{
      padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background: transparent; color:var(--text);
      min-width: 220px;
    }
    details{
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      background: color-mix(in oklab, var(--card) 88%, transparent);
    }
    details + details{margin-top:10px}
    summary{
      cursor:pointer; font-weight:600;
      list-style:none;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .tag{
      font-size:12px; color:var(--muted);
      border:1px solid var(--border);
      padding:3px 8px; border-radius:999px;
    }
    ul{margin:8px 0 0 18px}
    li{margin:4px 0}
    .two{
      display:grid; gap:10px;
      grid-template-columns: 1fr;
    }
    @media(min-width:800px){ .two{grid-template-columns: 1fr 1fr;} }
    .timeline{
      display:flex; gap:10px; overflow:auto; padding-bottom:6px;
      scroll-snap-type: x mandatory;
    }
    .event{
      scroll-snap-align:start;
      min-width:260px;
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
    }
    .event .year{font-family:var(--mono); color:var(--accent); font-size:16px}
    .event .title{font-weight:700; margin-top:6px}
    .event .meta{color:var(--muted); font-size:12px; margin-top:6px}
    .fc{
      display:grid; gap:12px; align-items:stretch;
    }
    @media(min-width:900px){ .fc{grid-template-columns: 1.1fr .9fr;} }
    .flashcard{
      min-height:240px;
      border:1px solid var(--border);
      border-radius:18px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
      box-shadow: var(--shadow);
      padding:14px;
      display:flex; flex-direction:column; justify-content:space-between;
      cursor:pointer;
    }
    .flashcard .front{font-size:18px; font-weight:700; line-height:1.3}
    .flashcard .back{display:none; margin-top:10px; color:var(--muted); line-height:1.5}
    .flashcard.revealed .back{display:block}
    .flashcard .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .flashcard .chips span{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--border); color:var(--muted);
    }
    .quizQ{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
      margin-top:10px;
    }
    .opt{
      display:block; margin-top:8px; padding:10px 12px;
      border:1px solid var(--border); border-radius:12px;
      cursor:pointer;
    }
    .opt.correct{border-color: color-mix(in oklab, var(--good) 60%, var(--border));}
    .opt.wrong{border-color: color-mix(in oklab, var(--bad) 60%, var(--border)); opacity:.95;}
    .small{font-size:12px; color:var(--muted)}
    .footer-note{color:var(--muted); font-size:12px; margin-top:10px; line-height:1.4}
    .divider{height:1px; background:var(--border); margin:12px 0}
    .hidden{display:none !important;}
    .callout{
      border-left:4px solid color-mix(in oklab, var(--accent) 60%, var(--border));
      padding:10px 12px; border-radius:12px; background: color-mix(in oklab, var(--card) 88%, transparent);
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>üìö Class 10 Complete Study App ‚Ä¢ NCERT</h1>
        <div class="sub">SST + Science + Math ‚Ä¢ Visual Learning + Practice + Quick Revision</div>
      </div>
      <div class="controls">
        <div class="pill" title="Your progress is saved locally in this browser (localStorage).">
          <div><strong id="streak">0</strong> day streak</div>
          <small>practice</small>
        </div>
        <button class="btn" id="resetBtn" title="Reset saved progress">Reset</button>
        <button class="btn primary" id="themeBtn" title="Toggle light/dark">Theme</button>
      </div>
    </div>
    
    <!-- SUBJECT TABS -->
    <div class="subject-tabs" role="tablist" aria-label="Subject Selection">
      <button class="subject-tab active" data-subject="sst">üìú SST (Social Science)</button>
      <button class="subject-tab" data-subject="science">üî¨ Science</button>
      <button class="subject-tab" data-subject="math">üî¢ Math</button>
    </div>
    
    <!-- SUBTABS (change based on subject) -->
    <div class="tabs" id="subTabs" role="tablist" aria-label="Feature Tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="chapters">Chapters</button>
      <button class="tab" data-tab="visual">Visual Learn</button>
      <button class="tab" data-tab="practice">Practice</button>
      <button class="tab" data-tab="flashcards">Flashcards</button>
      <button class="tab" data-tab="quiz">Quiz</button>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- ==================== SST CONTENT ==================== -->
  <div id="subject-sst" class="subject-content">
    
  <!-- OVERVIEW -->
  <section id="tab-overview">
    <div class="grid cols2">
      <div class="card">
        <h2>How to use (10‚Äì15 min/day)</h2>
        <ol>
          <li><b>Choose your subject</b>: SST, Science, or Math</li>
          <li><b>Visual Learn</b>: See diagrams & concept maps</li>
          <li><b>Practice</b>: Solve problems with step-by-step solutions</li>
          <li><b>Flashcards</b>: Quick revision & memory building</li>
          <li><b>Quiz</b>: Test yourself with instant feedback</li>
        </ol>
        <div class="callout">
          <b>Memory hack:</b> Visual learning + Practice + Repetition = Long-term memory!
          Use diagrams to understand, practice to apply, flashcards to memorize.
        </div>
        <div class="footer-note">All content aligned with NCERT Class 10 syllabus. Progress saved automatically in your browser.</div>
      </div>

      <div class="card">
        <h2>Quick anchors (the "must-know" years)</h2>
        <div class="two" id="anchorList"></div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>One-page cheat sheet (super short)</h2>
      <div class="two" id="cheatSheet"></div>
    </div>
  </section>

  <!-- CHAPTERS -->
  <section id="tab-chapters" class="hidden">
    <div class="row" style="margin-bottom:10px">
      <input id="chapterSearch" type="search" placeholder="Search people / places / keywords (e.g., 'Dandi', 'Vienna')" />
      <select id="chapterFilter">
        <option value="ALL">All chapters</option>
      </select>
    </div>
    <div id="chapterAccordions"></div>
  </section>
  <section id="tab-overview">
    <div class="grid cols2">
      <div class="card">
        <h2>How to use (10‚Äì15 min/day)</h2>
        <ol>
          <li><b>Read ‚Äú60‚Äësecond story‚Äù</b> for a chapter.</li>
          <li><b>Timeline scroll</b> (focus on 8‚Äì12 key years).</li>
          <li><b>Flashcards</b>: tap to reveal ‚Üí rate (Again/Hard/Good/Easy).</li>
          <li><b>Quiz</b>: do 10 mixed questions; repeat weak areas.</li>
        </ol>
        <div class="callout">
          <b>Memory hack:</b> Don‚Äôt try to memorize every date. Memorize <b>anchor years</b> + the story around them.
          This app highlights the anchor years repeatedly.
        </div>
        <div class="footer-note">Note: Content is condensed for exam revision. If your school uses extra chapters/editions, you can add more cards/events in the <span style="font-family:var(--mono)">DATA</span> section of the HTML.</div>
      </div>

      <div class="card">
        <h2>Quick anchors (the ‚Äúmust-know‚Äù years)</h2>
        <div class="two" id="anchorList"></div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>One-page cheat sheet (super short)</h2>
      <div class="two" id="cheatSheet"></div>
    </div>
  </section>

  <!-- VISUAL LEARNING (SST) -->
  <section id="tab-visual" class="hidden">
    <div class="card">
      <h2>Visual Timeline & Concept Maps</h2>
      <div class="timeline" id="timelineStrip"></div>
    </div>
  </section>

  <!-- PRACTICE (SST) -->
  <section id="tab-practice" class="hidden">
    <div class="card">
      <h2>Practice: Match the Pairs</h2>
      <div class="small muted">Connect events with years and people</div>
      <div id="matchPractice" style="margin-top:16px"></div>
    </div>
  </section>

  <!-- FLASHCARDS -->
  <section id="tab-chapters" class="hidden">
    <div class="row" style="margin-bottom:10px">
      <input id="chapterSearch" type="search" placeholder="Search people / places / keywords (e.g., 'Dandi', 'Vienna')" />
      <select id="chapterFilter">
        <option value="ALL">All chapters</option>
      </select>
    </div>
    <div id="chapterAccordions"></div>
  </section>

  <!-- TIMELINE -->
  <section id="tab-timeline" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Timeline (scroll sideways)</h2>
        <select id="timeFilter">
          <option value="ALL">All chapters</option>
        </select>
        <input id="timeSearch" type="search" placeholder="Search timeline (e.g., 1919, 'WWI', 'Germany')" />
      </div>
      <div class="divider"></div>
      <div class="timeline" id="timelineStrip"></div>
      <div class="footer-note">Tip: Focus first on the events marked <b>Anchor</b>. Those are the easiest ‚Äúexam points‚Äù.</div>
    </div>
  </section>

  <!-- FLASHCARDS -->
  <section id="tab-flashcards" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Flashcards (tap to reveal)</h2>
        <select id="deckSelect"></select>
        <button class="btn" id="shuffleBtn">Shuffle</button>
      </div>
      <div class="divider"></div>

      <div class="fc">
        <div class="flashcard" id="flashcard" tabindex="0" role="button" aria-label="Flashcard (tap to reveal)">
          <div>
            <div class="small" id="fcMeta">Deck ‚Ä¢ Card</div>
            <div class="front" id="fcFront">‚Äî</div>
            <div class="back" id="fcBack">‚Äî</div>
            <div class="chips" id="fcChips"></div>
          </div>
          <div class="small">Tap/click to reveal ‚Ä¢ Spacebar also works</div>
        </div>

        <div class="card" style="padding:12px">
          <h2>Rate your recall</h2>
          <div class="small">This uses a simple ‚ÄúLeitner box‚Äù system and saves progress in this browser.</div>
          <div class="divider"></div>
          <div class="row" style="gap:8px">
            <button class="btn bad" id="rateAgain">Again</button>
            <button class="btn" id="rateHard">Hard</button>
            <button class="btn good" id="rateGood">Good</button>
            <button class="btn primary" id="rateEasy">Easy</button>
          </div>
          <div class="divider"></div>
          <div class="kpi">
            <div class="box"><div class="big" id="box1">0</div><div class="muted">Box 1 (new)</div></div>
            <div class="box"><div class="big" id="box2">0</div><div class="muted">Box 2</div></div>
            <div class="box"><div class="big" id="box3">0</div><div class="muted">Box 3</div></div>
            <div class="box"><div class="big" id="box4">0</div><div class="muted">Box 4 (mastered)</div></div>
          </div>
          <div class="footer-note">Rule of thumb: if you can say the answer confidently in <b>5 seconds</b>, press <b>Easy</b>.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="tab-quiz" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Quiz (10 questions)</h2>
        <select id="quizFilter">
          <option value="ALL">All chapters</option>
        </select>
        <button class="btn primary" id="newQuizBtn">New Quiz</button>
      </div>
      <div class="divider"></div>
      <div id="quizArea"></div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn good" id="submitQuizBtn">Submit</button>
        <div class="pill"><div><b id="quizScore">0/0</b></div><small>score</small></div>
      </div>
      <div class="footer-note">Quiz questions are generated from the same knowledge cards (so reviewing flashcards boosts quiz score quickly).</div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section id="tab-progress" class="hidden">
    <div class="grid cols2">
      <div class="card">
        <h2>Progress snapshot</h2>
        <div class="kpi">
          <div class="box"><div class="big" id="pTotal">0</div><div class="muted">Total cards</div></div>
          <div class="box"><div class="big" id="pMastered">0</div><div class="muted">Mastered (Box 4)</div></div>
          <div class="box"><div class="big" id="pWeak">0</div><div class="muted">Weak (Box 1)</div></div>
        </div>
        <div class="divider"></div>
        <div class="small">Tip: If time is short, focus on <b>Box 1 + Anchor years</b>.</div>
      </div>
      <div class="card">
        <h2>What to memorize for exams</h2>
        <ul>
          <li><b>People + role</b> (who did what?)</li>
          <li><b>Places + why important</b> (where did it happen?)</li>
          <li><b>Cause ‚Üí event ‚Üí result</b> (the ‚Äústory chain‚Äù)</li>
          <li><b>Anchor years</b> (not every date)</li>
        </ul>
        <div class="callout">
          <b>Fast answer format (3 lines):</b><br>
          1) Context/cause<br>
          2) Main event/action<br>
          3) Result/impact
        </div>
      </div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section id="tab-progress" class="hidden">
    <div class="grid cols2">
      <div class="card">
        <h2>Progress snapshot</h2>
        <div class="kpi">
          <div class="box"><div class="big" id="pTotal">0</div><div class="muted">Total cards</div></div>
          <div class="box"><div class="big" id="pMastered">0</div><div class="muted">Mastered (Box 4)</div></div>
          <div class="box"><div class="big" id="pWeak">0</div><div class="muted">Weak (Box 1)</div></div>
        </div>
        <div class="divider"></div>
        <div class="small">Tip: If time is short, focus on <b>Box 1 + Anchor years</b>.</div>
      </div>
      <div class="card">
        <h2>What to memorize for exams</h2>
        <ul>
          <li><b>People + role</b> (who did what?)</li>
          <li><b>Places + why important</b> (where did it happen?)</li>
          <li><b>Cause ‚Üí event ‚Üí result</b> (the "story chain")</li>
          <li><b>Anchor years</b> (not every date)</li>
        </ul>
        <div class="callout">
          <b>Fast answer format (3 lines):</b><br>
          1) Context/cause<br>
          2) Main event/action<br>
          3) Result/impact
        </div>
      </div>
    </div>
  </section>
  </div>
  
  <!-- ==================== SCIENCE CONTENT ==================== -->
  <div id="subject-science" class="subject-content hidden">
    
    <!-- OVERVIEW -->
    <section id="sci-overview">
      <div class="card">
        <h2>üî¨ Class 10 Science - NCERT Syllabus</h2>
        <div class="grid cols3">
          <div class="card" style="border-color:var(--science)">
            <h3>‚ö° Physics</h3>
            <ul style="font-size:14px">
              <li>Light - Reflection & Refraction</li>
              <li>Human Eye</li>
              <li>Electricity</li>
              <li>Magnetic Effects</li>
              <li>Energy Sources</li>
            </ul>
          </div>
          <div class="card" style="border-color:var(--good)">
            <h3>üß™ Chemistry</h3>
            <ul style="font-size:14px">
              <li>Chemical Reactions</li>
              <li>Acids, Bases & Salts</li>
              <li>Metals & Non-metals</li>
              <li>Carbon Compounds</li>
              <li>Periodic Classification</li>
            </ul>
          </div>
          <div class="card" style="border-color:var(--accent2)">
            <h3>üå± Biology</h3>
            <ul style="font-size:14px">
              <li>Life Processes</li>
              <li>Control & Coordination</li>
              <li>Reproduction</li>
              <li>Heredity & Evolution</li>
              <li>Environment</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    
    <!-- CHAPTERS -->
    <section id="sci-chapters" class="hidden">
      <div class="card">
        <h2>Science Concepts - Quick Reference</h2>
        <select id="sciChapterSelect">
          <option value="light">Light - Reflection & Refraction</option>
          <option value="eye">Human Eye & Colourful World</option>
          <option value="electricity">Electricity</option>
          <option value="magnetic">Magnetic Effects of Current</option>
          <option value="reactions">Chemical Reactions</option>
          <option value="acids">Acids, Bases & Salts</option>
          <option value="life">Life Processes</option>
          <option value="control">Control & Coordination</option>
        </select>
        <div id="sciChapterContent" style="margin-top:16px"></div>
      </div>
    </section>
    
    <!-- VISUAL LEARNING (DIAGRAMS) -->
    <section id="sci-visual" class="hidden">
      <div class="card">
        <h2>üìä Visual Diagrams & Illustrations</h2>
        <div class="row" style="margin-bottom:12px">
          <select id="diagramSelect">
            <option value="refraction">Light Refraction through Glass Slab</option>
            <option value="eye">Human Eye Structure</option>
            <option value="circuit">Electric Circuit</option>
            <option value="ohm">Ohm's Law Graph</option>
            <option value="motor">Electric Motor</option>
            <option value="cell">Plant Cell vs Animal Cell</option>
            <option value="heart">Human Heart</option>
            <option value="neuron">Neuron Structure</option>
          </select>
        </div>
        <div id="diagramDisplay"></div>
      </div>
    </section>
    
    <!-- PRACTICE -->
    <section id="sci-practice" class="hidden">
      <div class="card">
        <h2>üß™ Practice Numericals</h2>
        <div id="sciPracticeArea"></div>
      </div>
    </section>
    
    <!-- FLASHCARDS -->
    <section id="sci-flashcards" class="hidden">
      <div class="card">
        <h2>Science Flashcards</h2>
        <div class="muted small">Key concepts, formulas, and diagrams</div>
        <div id="sciFlashcardArea" style="margin-top:16px">
          <div class="flashcard" style="min-height:200px; cursor:pointer" onclick="this.classList.toggle('revealed')">
            <div class="front">What is Ohm's Law?</div>
            <div class="back">V = IR<br>Voltage = Current √ó Resistance<br><br>üìå Remember: VIR (Very Important Rule)</div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- QUIZ -->
    <section id="sci-quiz" class="hidden">
      <div class="card">
        <h2>Science Quiz</h2>
        <button class="btn primary" onclick="generateScienceQuiz()">Start New Quiz</button>
        <div id="sciQuizArea" style="margin-top:16px"></div>
      </div>
    </section>
  </div>
  
  <!-- ==================== MATH CONTENT ==================== -->
  <div id="subject-math" class="subject-content hidden">
    
    <!-- OVERVIEW -->
    <section id="math-overview">
      <div class="card">
        <h2>üî¢ Class 10 Math - NCERT Syllabus</h2>
        <div class="grid cols2">
          <div class="card" style="border-color:var(--math)">
            <h3>üìê Chapters</h3>
            <ol style="font-size:14px; line-height:1.8">
              <li>Real Numbers</li>
              <li>Polynomials</li>
              <li>Linear Equations (Pair)</li>
              <li>Quadratic Equations</li>
              <li>Arithmetic Progressions</li>
              <li>Triangles</li>
              <li>Coordinate Geometry</li>
              <li>Trigonometry</li>
              <li>Circles</li>
              <li>Statistics & Probability</li>
            </ol>
          </div>
          <div class="card" style="border-color:var(--accent)">
            <h3>‚ö° Quick Formulas</h3>
            <div class="formula-box">
              <div><b>Quadratic:</b> ax¬≤ + bx + c = 0</div>
              <div style="margin-top:8px"><b>Roots:</b> x = [-b ¬± ‚àö(b¬≤-4ac)] / 2a</div>
            </div>
            <div class="formula-box">
              <div><b>Pythagoras:</b> a¬≤ + b¬≤ = c¬≤</div>
            </div>
            <div class="formula-box">
              <div><b>sin¬≤Œ∏ + cos¬≤Œ∏ = 1</b></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- CHAPTERS -->
    <section id="math-chapters" class="hidden">
      <div class="card">
        <h2>Math Concepts - Step by Step</h2>
        <select id="mathChapterSelect" onchange="loadMathChapter(this.value)">
          <option value="realnumbers">Real Numbers</option>
          <option value="polynomials">Polynomials</option>
          <option value="linear">Linear Equations</option>
          <option value="quadratic">Quadratic Equations</option>
          <option value="ap">Arithmetic Progressions</option>
          <option value="triangles">Triangles</option>
          <option value="trigonometry">Trigonometry</option>
        </select>
        <div id="mathChapterContent" style="margin-top:16px"></div>
      </div>
    </section>
    
    <!-- VISUAL LEARNING (FORMULAS & GRAPHS) -->
    <section id="math-visual" class="hidden">
      <div class="card">
        <h2>üìà Interactive Formulas & Graphs</h2>
        <div id="mathVisualArea"></div>
      </div>
    </section>
    
    <!-- PRACTICE -->
    <section id="math-practice" class="hidden">
      <div class="card">
        <h2>üìù Practice Problems</h2>
        <div class="row" style="margin-bottom:12px">
          <select id="mathPracticeSelect" onchange="loadMathPractice(this.value)">
            <option value="quadratic">Quadratic Equations</option>
            <option value="ap">Arithmetic Progressions</option>
            <option value="trigonometry">Trigonometry</option>
            <option value="statistics">Statistics</option>
          </select>
        </div>
        <div id="mathPracticeArea"></div>
      </div>
    </section>
    
    <!-- FLASHCARDS -->
    <section id="math-flashcards" class="hidden">
      <div class="card">
        <h2>Math Formula Flashcards</h2>
        <div id="mathFlashcardArea" style="margin-top:16px"></div>
      </div>
    </section>
    
    <!-- QUIZ -->
    <section id="math-quiz" class="hidden">
      <div class="card">
        <h2>Math Quiz</h2>
        <button class="btn primary" onclick="generateMathQuiz()">Start New Quiz</button>
        <div id="mathQuizArea" style="margin-top:16px"></div>
      </div>
    </section>
  </div>
</main>

<script>
/* =========================
   GLOBAL STATE & STORAGE
   ========================= */
let CURRENT_SUBJECT = 'sst';
let CURRENT_TAB = 'overview';

const STORE_KEY = "quicklearn_multisubject_v1";
function loadStore(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || null; }catch(e){ return null; }
}
function saveStore(obj){ localStorage.setItem(STORE_KEY, JSON.stringify(obj)); }

function todayStr(){
  const d = new Date();
  return d.toISOString().slice(0,10);
}
function initStore(){
  const s = loadStore();
  if(s) return s;
  const boxes = {};
  CARDS.forEach(c => boxes[c.id] = 1);
  const state = { 
    theme:"dark", 
    boxes, 
    lastPractice:null, 
    streak:0, 
    deck:"ALL", 
    order:[], 
    idx:0,
    subject: 'sst'
  };
  saveStore(state);
  return state;
}

/* =========================
   SST DATA
   ========================= */
const CHAPTERS = [
  {id:"EU", title:"1. The Rise of Nationalism in Europe"},
  {id:"IN", title:"2. Nationalism in India"},
  {id:"GW", title:"3. The Making of a Global World"},
  {id:"AI", title:"4. The Age of Industrialisation"},
  {id:"PC", title:"5. Print Culture and the Modern World"},
];

// Timeline events (very condensed)
const EVENTS = [
  // Europe
  {id:"EU1789", chapter:"EU", year:"1789", anchor:true, title:"French Revolution", detail:"Ideas of liberty, equality, fraternity ‚Üí nationalism grows.", people:["French revolutionaries"], places:["France"], tags:["politics"]},
  {id:"EU1815", chapter:"EU", year:"1815", anchor:true, title:"Congress of Vienna", detail:"Conservatives restore monarchies; redraw Europe after Napoleon.", people:["Metternich"], places:["Vienna"], tags:["politics"]},
  {id:"EU1830", chapter:"EU", year:"1830", anchor:true, title:"Revolutions of 1830", detail:"France (July Revolution); Belgium becomes independent.", people:["Revolutionaries"], places:["France","Belgium"], tags:["politics"]},
  {id:"EU1848", chapter:"EU", year:"1848", anchor:true, title:"Revolutions of 1848", detail:"Liberals demand constitutions; Frankfurt Parliament tries German unity.", people:["Liberals"], places:["German states","Frankfurt"], tags:["politics"]},
  {id:"EU1861", chapter:"EU", year:"1861", anchor:true, title:"Unification of Italy", detail:"King Victor Emmanuel II becomes king of united Italy.", people:["Cavour","Garibaldi","Victor Emmanuel II"], places:["Italy"], tags:["politics"]},
  {id:"EU1871", chapter:"EU", year:"1871", anchor:true, title:"Unification of Germany", detail:"German empire proclaimed after victory over France.", people:["Bismarck","Kaiser William I"], places:["Germany","Versailles"], tags:["politics"]},

  // India
  {id:"IN1915", chapter:"IN", year:"1915", anchor:true, title:"Gandhi returns to India", detail:"Brings satyagraha methods from South Africa.", people:["M.K. Gandhi"], places:["India"], tags:["politics"]},
  {id:"IN1917", chapter:"IN", year:"1917", anchor:true, title:"Champaran Satyagraha", detail:"Indigo peasants; Gandhi‚Äôs early success in India.", people:["M.K. Gandhi"], places:["Champaran (Bihar)"], tags:["movement"]},
  {id:"IN1919", chapter:"IN", year:"1919", anchor:true, title:"Rowlatt Act & Jallianwala Bagh", detail:"Repression sparks mass anger; turning point in national movement.", people:["General Dyer"], places:["Amritsar"], tags:["movement"]},
  {id:"IN1920", chapter:"IN", year:"1920", anchor:true, title:"Non‚ÄëCooperation begins", detail:"Boycott British institutions; linked with Khilafat.", people:["Gandhi","Ali brothers"], places:["Across India"], tags:["movement"]},
  {id:"IN1922", chapter:"IN", year:"1922", anchor:true, title:"Chauri Chaura", detail:"Violence ‚Üí Gandhi withdraws Non‚ÄëCooperation.", people:["Gandhi"], places:["Chauri Chaura (UP)"], tags:["movement"]},
  {id:"IN1930", chapter:"IN", year:"1930", anchor:true, title:"Civil Disobedience & Dandi March", detail:"Salt law broken; mass participation.", people:["Gandhi"], places:["Dandi"], tags:["movement"]},
  {id:"IN1931", chapter:"IN", year:"1931", anchor:false, title:"Gandhi‚ÄëIrwin Pact", detail:"CDM suspended; Gandhi attends Round Table Conference.", people:["Gandhi","Lord Irwin"], places:["Delhi/London"], tags:["politics"]},
  {id:"IN1932", chapter:"IN", year:"1932", anchor:true, title:"Poona Pact", detail:"Agreement on representation of depressed classes.", people:["B.R. Ambedkar","Gandhi"], places:["Poona"], tags:["society"]},
  {id:"IN1942", chapter:"IN", year:"1942", anchor:true, title:"Quit India Movement", detail:"‚ÄòDo or Die‚Äô call; mass upsurge against British rule.", people:["Gandhi"], places:["India"], tags:["movement"]},

  // Global world
  {id:"GW1492", chapter:"GW", year:"1492", anchor:false, title:"Columbus reaches Americas", detail:"Start of European expansion; reshapes world trade.", people:["Columbus"], places:["Americas"], tags:["trade"]},
  {id:"GW1800s", chapter:"GW", year:"1800s", anchor:true, title:"Indentured labour migration", detail:"Workers sent to plantations (Caribbean, Fiji, Mauritius) after slavery declines.", people:["Indentured labourers"], places:["Caribbean","Fiji","Mauritius"], tags:["migration"]},
  {id:"GW1914", chapter:"GW", year:"1914‚Äì18", anchor:true, title:"First World War", detail:"War economy + disruption in trade; affects colonies too.", people:["Allied/Axis powers"], places:["Europe/World"], tags:["war"]},
  {id:"GW1929", chapter:"GW", year:"1929", anchor:true, title:"Great Depression", detail:"World demand collapses; farmers & workers suffer worldwide.", people:["‚Äî"], places:["USA/World"], tags:["economy"]},
  {id:"GW1945", chapter:"GW", year:"1945", anchor:false, title:"Post‚Äëwar world economy", detail:"Reconstruction; new institutions; decolonisation accelerates.", people:["‚Äî"], places:["World"], tags:["economy"]},

  // Industrialisation
  {id:"AI1700s", chapter:"AI", year:"1700s", anchor:true, title:"Industrial Revolution (Britain)", detail:"Factories, machines, and new labour systems expand.", people:["Inventors/industrialists"], places:["Britain"], tags:["industry"]},
  {id:"AI1850s", chapter:"AI", year:"1850s", anchor:false, title:"Railways & steamships expand trade", detail:"Faster transport connects markets; spreads industrial goods.", people:["‚Äî"], places:["Europe/India"], tags:["trade"]},
  {id:"AI1900", chapter:"AI", year:"1900", anchor:true, title:"Indian factories grow", detail:"Cotton/jute industries expand; Indian entrepreneurs rise.", people:["Indian industrialists"], places:["Bombay/Calcutta"], tags:["industry"]},

  // Print culture
  {id:"PC1450", chapter:"PC", year:"1450s", anchor:true, title:"Gutenberg printing press", detail:"Print becomes cheaper ‚Üí knowledge spreads faster in Europe.", people:["Johannes Gutenberg"], places:["Germany"], tags:["culture"]},
  {id:"PC1517", chapter:"PC", year:"1517", anchor:false, title:"Reformation & print", detail:"Print helps spread new religious ideas across Europe.", people:["Martin Luther"], places:["Europe"], tags:["culture"]},
  {id:"PC1700s", chapter:"PC", year:"1700s", anchor:true, title:"Enlightenment & newspapers", detail:"Public debate grows; ideas of rights & citizenship spread.", people:["Philosophers"], places:["Europe"], tags:["culture"]},
  {id:"PC1800sIN", chapter:"PC", year:"1800s", anchor:true, title:"Print in India expands", detail:"Vernacular press, novels, textbooks; social reform debates.", people:["Indian writers/reformers"], places:["Calcutta/Bombay/Madras"], tags:["culture"]},
];

/* Flashcards: Front = question; Back = short answer + ‚Äúwhy it matters‚Äù + mnemonic */
const CARDS = [
  // Europe
  {id:"cEU1", chapter:"EU", front:"1789: What happened and why is it important for nationalism?", back:"French Revolution: people demand rights + citizenship. It spreads the idea that a nation is made of citizens (not just kings).  \nMnemonic: '89 = Revolution‚Äôs gate.'", tags:["1789","France","nationalism"], year:"1789"},
  {id:"cEU2", chapter:"EU", front:"1815: Congress of Vienna ‚Äî what was its goal?", back:"To restore old monarchies + create balance of power after Napoleon; conservatives try to stop revolutionary nationalism.  \nAnchor: Vienna = 'V' for 'Very conservative'.", tags:["1815","Vienna","Metternich"], year:"1815"},
  {id:"cEU3", chapter:"EU", front:"1848: Frankfurt Parliament tried to do what?", back:"Create a unified German nation with a constitution, but failed (king rejected crown; divisions).  \nExam line: ‚ÄòLiberal nationalism rose but was crushed.‚Äô", tags:["1848","Frankfurt","Germany"], year:"1848"},
  {id:"cEU4", chapter:"EU", front:"1871: How did Germany unify?", back:"Prussia under Bismarck used wars + diplomacy; German Empire proclaimed (symbol of strong nationalism).  \nMnemonic: '71 = Germany becomes ONE.'", tags:["1871","Bismarck","Germany"], year:"1871"},

  // India
  {id:"cIN1", chapter:"IN", front:"1919: Why is Jallianwala Bagh a turning point?", back:"British troops killed unarmed people in Amritsar ‚Üí mass anger; trust in British rule collapses; nationalism spreads deeper.  \nAnchor: 1919 = ‚Äò19 = blood-stained line‚Äô.", tags:["1919","Amritsar","Jallianwala"], year:"1919"},
  {id:"cIN2", chapter:"IN", front:"1920: What is Non‚ÄëCooperation? Give 2 examples.", back:"Mass boycott of British institutions to win swaraj: (1) leave govt jobs/schools/courts, (2) boycott foreign cloth, promote khadi/swadeshi.  \n3-line answer: cause (Rowlatt/Jallianwala) ‚Üí boycott ‚Üí impact (mass politics).", tags:["1920","boycott","khadi"], year:"1920"},
  {id:"cIN3", chapter:"IN", front:"1930: Why did Gandhi choose salt for Civil Disobedience?", back:"Salt tax affected everyone (rich/poor). Breaking salt law was a simple, powerful symbol of injustice.  \nMnemonic: ‚ÄòSalt = small thing, big fight.‚Äô", tags:["1930","Dandi","salt"], year:"1930"},
  {id:"cIN4", chapter:"IN", front:"1942: What is the message of Quit India?", back:"‚ÄòDo or Die‚Äô‚ÄîBritish must leave immediately; mass protests despite repression.  \nAnchor: 42 = ‚Äòfinal push‚Äô phase.", tags:["1942","Quit India"], year:"1942"},

  // Global world
  {id:"cGW1", chapter:"GW", front:"What is ‚Äòglobalisation‚Äô in this chapter (simple meaning)?", back:"Growing connections between countries through trade, migration, capital, and ideas (a world becoming linked).", tags:["trade","migration"]},
  {id:"cGW2", chapter:"GW", front:"1929: How did the Great Depression hurt India?", back:"Prices & demand fell ‚Üí farmers got less for crops; unemployment rose; colonial economy worsened poverty.  \nAnchor: 1929 = ‚Äòworld demand dies‚Äô.", tags:["1929","depression","India"], year:"1929"},

  // Industrialisation
  {id:"cAI1", chapter:"AI", front:"What is ‚Äòindustrialisation‚Äô?", back:"Shift from hand production to machine + factory production; big change in labour, transport, and markets.", tags:["factories","machines"]},
  {id:"cAI2", chapter:"AI", front:"Why did handloom weaving survive (even with factories)?", back:"Demand for fine designs; adaptation; some consumers preferred hand-made cloth; also factory cloth wasn‚Äôt always suitable.  \nExam keyword: ‚Äòflexibility + niche markets‚Äô.", tags:["handloom","weavers"]},

  // Print culture
  {id:"cPC1", chapter:"PC", front:"1450s: Why is Gutenberg important?", back:"He made printing faster/cheaper ‚Üí books & ideas spread widely ‚Üí helped Reformation, Enlightenment, and modern public opinion.", tags:["1450s","Gutenberg","press"], year:"1450s"},
  {id:"cPC2", chapter:"PC", front:"How did print help nationalism?", back:"Newspapers + novels created a shared language/ideas; people imagined themselves as one community.  \nPhrase: ‚ÄòPrint made a public‚Äô ‚Üí ‚Äòpublic made a nation‚Äô.", tags:["newspapers","novels","nation"]},
];

/* =========================
   STORAGE (Leitner + streak)
   ========================= */
const STORE_KEY = "quicklearn_v1";
function loadStore(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || null; }catch(e){ return null; }
}
function saveStore(obj){ localStorage.setItem(STORE_KEY, JSON.stringify(obj)); }

function todayStr(){
  const d = new Date();
  return d.toISOString().slice(0,10);
}
function initStore(){
  const s = loadStore();
  if(s) return s;
  // default: all cards start in box 1
  const boxes = {};
  CARDS.forEach(c => boxes[c.id] = 1);
  const state = { theme:"dark", boxes, lastPractice:null, streak:0, deck:"ALL", order:[], idx:0, subject: 'sst' };
  saveStore(state);
  return state;
}

/* =========================
   Build overview (SST specific functions)
   ========================= */
function buildAnchors(){
  const anchors = EVENTS.filter(e=>e.anchor).sort((a,b)=> String(a.year).localeCompare(String(b.year)));
  const byChap = {};
  anchors.forEach(e=>{
    byChap[e.chapter] ||= [];
    byChap[e.chapter].push(e);
  });
  const holder = $("#anchorList");
  holder.innerHTML = "";
  CHAPTERS.forEach(ch=>{
    const list = byChap[ch.id] || [];
    const card = document.createElement("div");
    card.className = "card";
    card.style.padding = "12px";
    card.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <b>${ch.title}</b>
        <span class="tag">${list.length} anchors</span>
      </div>
      <ul>${list.map(x=>`<li><span style="font-family:var(--mono); color:var(--accent)">${x.year}</span> ‚Äî ${x.title}</li>`).join("")}</ul>
    `;
    holder.appendChild(card);
  });
}

function buildCheatSheet(){
  const cheats = {
    EU: [
      "Nationalism = people feel they belong to one nation.",
      "French Revolution spreads citizenship + rights.",
      "Conservatives (1815 Vienna) try to stop revolutions.",
      "1830/1848 revolutions show liberal nationalism rising.",
      "Italy (1861) and Germany (1871) unify ‚Üí nation-states.",
    ],
    IN: [
      "Nationalism grows through movements + shared symbols.",
      "1919 repression (Rowlatt/Jallianwala) ‚Üí mass anger.",
      "Non‚ÄëCooperation (1920) = boycott British institutions.",
      "Civil Disobedience (1930) = break unjust laws (salt).",
      "Quit India (1942) = final mass push for freedom.",
    ],
    GW: [
      "Global world = trade + migration + capital connections.",
      "Colonialism + plantations changed world economy.",
      "Indentured labour moved workers across oceans (1800s).",
      "WWI (1914‚Äì18) disrupts trade and economies.",
      "Great Depression (1929) crashes demand worldwide.",
    ],
    AI: [
      "Industrialisation = factories + machines + new labour.",
      "Small producers survive by adapting and specialising.",
      "Railways/steamships expand markets.",
      "In India, cotton/jute industries grow; entrepreneurs rise.",
      "Workers face harsh conditions; unions/struggles emerge.",
    ],
    PC: [
      "Print makes ideas travel fast and cheap.",
      "Gutenberg (1450s) ‚Üí printing revolution.",
      "Print helps Reformation + Enlightenment + public opinion.",
      "In India, vernacular press + novels shape debates.",
      "Print supports nationalism by creating shared identity.",
    ]
  };

  const holder = $("#cheatSheet");
  holder.innerHTML = "";
  CHAPTERS.forEach(ch=>{
    const d = document.createElement("div");
    d.className = "card";
    d.style.padding = "12px";
    d.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <b>${ch.title}</b>
        <span class="tag">60 sec</span>
      </div>
      <ul>${(cheats[ch.id]||[]).map(x=>`<li>${x}</li>`).join("")}</ul>
    `;
    holder.appendChild(d);
  });
}

/* =========================
   Build chapters accordion
   ========================= */
function buildChapterFilter(){
  const s1 = $("#chapterFilter");
  const s2 = $("#timeFilter");
  const s3 = $("#deckSelect");
  const s4 = $("#quizFilter");
  [s1,s2,s4].forEach(sel=>{
    CHAPTERS.forEach(ch=>{
      const o = document.createElement("option");
      o.value = ch.id; o.textContent = ch.title;
      sel.appendChild(o);
    });
  });

  // decks
  s3.innerHTML = "";
  const all = document.createElement("option");
  all.value="ALL"; all.textContent="All Chapters (mixed)";
  s3.appendChild(all);
  CHAPTERS.forEach(ch=>{
    const o = document.createElement("option");
    o.value = ch.id; o.textContent = ch.title;
    s3.appendChild(o);
  });
  s3.value = STATE.deck || "ALL";
}

function chapterFacts(chId){
  const ev = EVENTS.filter(e=>e.chapter===chId);
  const anchors = ev.filter(e=>e.anchor);
  const people = [...new Set(ev.flatMap(e=>e.people||[]).filter(x=>x && x!=="‚Äî"))].slice(0,8);
  const places = [...new Set(ev.flatMap(e=>e.places||[]))].slice(0,10);
  return {ev, anchors, people, places};
}

function buildChapters(){
  const search = $("#chapterSearch").value.trim().toLowerCase();
  const filter = $("#chapterFilter").value;

  const holder = $("#chapterAccordions");
  holder.innerHTML = "";

  CHAPTERS.filter(ch=> filter==="ALL" ? true : ch.id===filter).forEach(ch=>{
    const facts = chapterFacts(ch.id);

    // 60 sec story (super condensed)
    const story = {
      EU:"Europe‚Äôs nationalism grows after the French Revolution. Conservatives try to stop it (1815 Vienna), but revolutions (1830/1848) keep returning. Finally, strong leaders unify Italy (1861) and Germany (1871), creating modern nation‚Äëstates.",
      IN:"Indian nationalism grows through shared symbols and mass movements. Repression in 1919 sparks anger. Non‚ÄëCooperation (1920) uses boycott; Civil Disobedience (1930) breaks unjust laws; Quit India (1942) becomes the final mass push.",
      GW:"The world becomes connected through trade, conquest, and migration. Plantations and colonial rule reshape economies. Indentured labour moves across oceans. WWI and the Great Depression disrupt global trade and cause suffering worldwide.",
      AI:"Industrialisation shifts production to factories and machines. Markets expand through transport. In India, handloom survives by adapting; factories grow in cotton/jute. Workers face harsh conditions, leading to struggles and new politics.",
      PC:"Print makes ideas spread quickly: Gutenberg‚Äôs press (1450s) transforms Europe. Print supports Reformation and Enlightenment. In India, vernacular press and novels shape social reform and nationalism by creating shared public opinion."
    }[ch.id];

    const matches = (text)=> (text||"").toLowerCase().includes(search);
    const visible =
      !search ||
      matches(ch.title) ||
      matches(story) ||
      facts.ev.some(e=> matches(e.title) || matches(e.detail) || (e.places||[]).some(p=>matches(p)) || (e.people||[]).some(p=>matches(p)));

    if(!visible) return;

    const det = document.createElement("details");
    det.open = false;
    det.innerHTML = `
      <summary>
        <span>${ch.title}</span>
        <span class="tag">${facts.anchors.length} anchors</span>
      </summary>
      <div class="two" style="margin-top:10px">
        <div>
          <div class="callout"><b>Big story (60 seconds):</b><br>${story}</div>
          <div class="divider"></div>
          <b>Anchor years (memorize these):</b>
          <ul>${facts.anchors.map(e=>`<li><span style="font-family:var(--mono); color:var(--accent)">${e.year}</span> ‚Äî ${e.title}</li>`).join("") || "<li class='muted'>‚Äî</li>"}</ul>
        </div>
        <div>
          <b>Key people:</b>
          <div class="row" style="margin-top:8px">${facts.people.map(p=>`<span class="tag">${p}</span>`).join("") || "<span class='muted'>‚Äî</span>"}</div>
          <div class="divider"></div>
          <b>Key places:</b>
          <div class="row" style="margin-top:8px">${facts.places.map(p=>`<span class="tag">${p}</span>`).join("") || "<span class='muted'>‚Äî</span>"}</div>
          <div class="divider"></div>
          <b>Exam-ready 3-line template:</b>
          <ul>
            <li><b>Cause/Context:</b> what problem led to it?</li>
            <li><b>Main Event:</b> what happened?</li>
            <li><b>Impact:</b> what changed?</li>
          </ul>
        </div>
      </div>
    `;
    holder.appendChild(det);
  });

  if(!holder.children.length){
    holder.innerHTML = `<div class="card"><h2>No matches</h2><div class="muted">Try a broader keyword.</div></div>`;
  }
}

/* =========================
   Build timeline
   ========================= */
function buildTimeline(){
  const filter = $("#timeFilter").value;
  const q = $("#timeSearch").value.trim().toLowerCase();
  const list = EVENTS
    .filter(e => filter==="ALL" ? true : e.chapter===filter)
    .filter(e => !q ? true :
      String(e.year).toLowerCase().includes(q) ||
      e.title.toLowerCase().includes(q) ||
      (e.detail||"").toLowerCase().includes(q) ||
      (e.places||[]).some(p=>p.toLowerCase().includes(q)) ||
      (e.people||[]).some(p=>p.toLowerCase().includes(q))
    )
    .sort((a,b)=> String(a.year).localeCompare(String(b.year), undefined, {numeric:true}));

  const strip = $("#timelineStrip");
  strip.innerHTML = "";
  list.forEach(e=>{
    const ch = CHAPTERS.find(x=>x.id===e.chapter)?.title || e.chapter;
    const el = document.createElement("div");
    el.className = "event";
    el.innerHTML = `
      <div class="year">${e.year} ${e.anchor ? `<span class="tag" style="margin-left:8px">Anchor</span>` : ""}</div>
      <div class="title">${e.title}</div>
      <div class="meta">${ch}</div>
      <div style="margin-top:8px; line-height:1.5">${e.detail}</div>
      <div class="meta" style="margin-top:10px">
        ${(e.places?.length? `üìç ${e.places.join(", ")}`:"")}
        ${(e.people?.filter(x=>x && x!=="‚Äî").length? `<br>üë§ ${e.people.filter(x=>x&&x!=="‚Äî").join(", ")}`:"")}
      </div>
    `;
    strip.appendChild(el);
  });
  if(!list.length){
    strip.innerHTML = `<div class="event"><div class="title">No events found</div><div class="meta">Try removing filters.</div></div>`;
  }
}

/* =========================
   Flashcards (Leitner)
   ========================= */
function cardsForDeck(deck){
  return CARDS.filter(c => deck==="ALL" ? true : c.chapter===deck);
}

function rebuildOrder(){
  // Weighted: prefer lower boxes
  const deck = $("#deckSelect").value;
  STATE.deck = deck;
  const pool = cardsForDeck(deck);

  const weighted = [];
  pool.forEach(c=>{
    const box = STATE.boxes[c.id] || 1;
    const w = (5 - box); // box1 more weight
    for(let i=0;i<w;i++) weighted.push(c.id);
  });

  // shuffle
  for(let i=weighted.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [weighted[i], weighted[j]] = [weighted[j], weighted[i]];
  }

  // de-duplicate while keeping order-ish
  const seen = new Set();
  const order = [];
  for(const id of weighted){
    if(!seen.has(id)){ seen.add(id); order.push(id); }
  }
  // fallback if something weird happens
  STATE.order = order.length ? order : pool.map(c=>c.id);
  STATE.idx = 0;
  saveStore(STATE);
  updateBoxesUI();
  renderFlashcard();
}

function currentCard(){
  const id = STATE.order[STATE.idx];
  return CARDS.find(c=>c.id===id) || CARDS[0];
}

function renderFlashcard(){
  const card = currentCard();
  if(!card) return;
  const deckName = $("#deckSelect").selectedOptions[0]?.textContent || "Deck";
  $("#fcMeta").textContent = `${deckName} ‚Ä¢ ${STATE.idx+1}/${STATE.order.length} ‚Ä¢ Box ${STATE.boxes[card.id]||1}`;
  $("#fcFront").textContent = card.front;
  $("#fcBack").textContent = card.back;
  const chips = [];
  chips.push(CHAPTERS.find(c=>c.id===card.chapter)?.title || card.chapter);
  (card.tags||[]).slice(0,5).forEach(t=>chips.push("#"+t));
  if(card.year) chips.push("üóì "+card.year);
  $("#fcChips").innerHTML = chips.map(x=>`<span>${x}</span>`).join("");
  $("#flashcard").classList.remove("revealed");
}

function nextCard(){
  STATE.idx = (STATE.idx + 1) % STATE.order.length;
  saveStore(STATE);
  renderFlashcard();
}

function rateCard(level){
  // update streak
  const today = todayStr();
  if(STATE.lastPractice !== today){
    // streak logic
    const last = STATE.lastPractice ? new Date(STATE.lastPractice) : null;
    const t = new Date(today);
    const diffDays = last ? Math.round((t-last)/(1000*60*60*24)) : null;
    if(diffDays === 1) STATE.streak = (STATE.streak||0) + 1;
    else STATE.streak = 1;
    STATE.lastPractice = today;
  }

  const card = currentCard();
  const cur = STATE.boxes[card.id] || 1;
  let nextBox = cur;

  if(level==="again") nextBox = 1;
  else if(level==="hard") nextBox = Math.max(1, cur); // keep
  else if(level==="good") nextBox = Math.min(4, cur+1);
  else if(level==="easy") nextBox = Math.min(4, cur+2);

  STATE.boxes[card.id] = nextBox;
  saveStore(STATE);
  updateBoxesUI();
  updateStreakUI();
  nextCard();
}

function updateBoxesUI(){
  const counts = {1:0,2:0,3:0,4:0};
  const deck = STATE.deck || "ALL";
  cardsForDeck(deck).forEach(c=>{
    counts[STATE.boxes[c.id]||1] += 1;
  });
  $("#box1").textContent = counts[1];
  $("#box2").textContent = counts[2];
  $("#box3").textContent = counts[3];
  $("#box4").textContent = counts[4];

  // progress page
  const allCards = CARDS.length;
  const mastered = Object.values(STATE.boxes).filter(x=>x===4).length;
  const weak = Object.values(STATE.boxes).filter(x=>(x||1)===1).length;
  $("#pTotal").textContent = allCards;
  $("#pMastered").textContent = mastered;
  $("#pWeak").textContent = weak;
}

function updateStreakUI(){
  $("#streak").textContent = STATE.streak || 0;
}

/* =========================
   Quiz (from cards)
   ========================= */
let QUIZ = [];
function makeQuiz(deck="ALL", n=10){
  const pool = cardsForDeck(deck);
  // build multiple-choice questions by using other card backs as distractors
  const shuffled = [...pool].sort(()=>Math.random()-0.5).slice(0, Math.min(n, pool.length));
  QUIZ = shuffled.map((c, idx)=>{
    const correct = c.back.split("\n")[0].trim(); // first line
    const others = pool.filter(x=>x.id!==c.id).sort(()=>Math.random()-0.5).slice(0,3).map(x=>x.back.split("\n")[0].trim());
    const options = [...others, correct].sort(()=>Math.random()-0.5);
    return {id:"q"+idx, cardId:c.id, prompt:c.front, options, correct};
  });
  renderQuiz();
}

function renderQuiz(){
  const area = $("#quizArea");
  area.innerHTML = "";
  QUIZ.forEach((q, i)=>{
    const box = document.createElement("div");
    box.className = "quizQ";
    box.innerHTML = `
      <div class="small">Q${i+1}</div>
      <div style="font-weight:700; margin-top:4px">${q.prompt}</div>
      <div id="${q.id}-opts"></div>
      <div class="small" id="${q.id}-fb" style="margin-top:8px"></div>
    `;
    area.appendChild(box);

    const opts = box.querySelector("#"+q.id+"-opts");
    q.options.forEach((opt, oi)=>{
      const d = document.createElement("div");
      d.className = "opt";
      d.textContent = opt;
      d.dataset.qid = q.id;
      d.dataset.opt = opt;
      d.addEventListener("click", ()=>{
        // single select
        $$("#"+q.id+"-opts .opt").forEach(x=>x.classList.remove("selected"));
        d.classList.add("selected");
        d.dataset.selected = "1";
      });
      opts.appendChild(d);
    });
  });
  $("#quizScore").textContent = `0/${QUIZ.length}`;
}

function gradeQuiz(){
  let score = 0;
  QUIZ.forEach(q=>{
    const selected = Array.from(document.querySelectorAll(`#${q.id}-opts .opt.selected`))[0];
    const fb = document.getElementById(q.id+"-fb");
    $$("#"+q.id+"-opts .opt").forEach(x=>{
      x.classList.remove("correct","wrong");
      if(x.textContent===q.correct) x.classList.add("correct");
    });
    if(selected){
      if(selected.textContent===q.correct){
        score += 1;
        fb.textContent = "‚úÖ Correct";
        fb.style.color = "var(--good)";
      }else{
        selected.classList.add("wrong");
        fb.textContent = "‚ùå Wrong ‚Äî review this flashcard next";
        fb.style.color = "var(--bad)";
        // push wrong one back to Box 1 to force review
        const cid = q.cardId;
        STATE.boxes[cid] = 1;
      }
    }else{
      fb.textContent = "‚ö†Ô∏è Not answered";
      fb.style.color = "var(--muted)";
    }
  });
  saveStore(STATE);
  updateBoxesUI();
  $("#quizScore").textContent = `${score}/${QUIZ.length}`;
}

/* =========================
   SCIENCE DIAGRAMS (SVG)
   ========================= */
const DIAGRAMS = {
  refraction: `
    <div class="diagram">
      <h3>Light Refraction through Glass Slab</h3>
      <svg viewBox="0 0 400 300" style="max-width:500px">
        <!-- Glass slab -->
        <rect x="150" y="50" width="100" height="200" fill="rgba(100,180,255,0.3)" stroke="#5aa6ff" stroke-width="2"/>
        <!-- Incident ray -->
        <line x1="50" y1="120" x2="150" y2="150" stroke="#ffb454" stroke-width="3" marker-end="url(#arrow)"/>
        <!-- Refracted ray inside -->
        <line x1="150" y1="150" x2="250" y2="170" stroke="#ff6b6b" stroke-width="3" marker-end="url(#arrow)"/>
        <!-- Emergent ray -->
        <line x1="250" y1="170" x2="350" y2="200" stroke="#53d18c" stroke-width="3" marker-end="url(#arrow)"/>
        <!-- Normal lines -->
        <line x1="150" y1="50" x2="150" y2="250" stroke="white" stroke-width="1" stroke-dasharray="5,5" opacity="0.5"/>
        <line x1="250" y1="50" x2="250" y2="250" stroke="white" stroke-width="1" stroke-dasharray="5,5" opacity="0.5"/>
        <!-- Labels -->
        <text x="60" y="110" fill="#ffb454" font-size="14">Incident Ray</text>
        <text x="160" y="160" fill="#ff6b6b" font-size="14">Refracted</text>
        <text x="260" y="210" fill="#53d18c" font-size="14">Emergent Ray</text>
        <text x="160" y="270" fill="#5aa6ff" font-size="16" font-weight="bold">Glass Slab</text>
        <defs>
          <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#ffb454"/>
          </marker>
        </defs>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>Key Points:</b><br>
        ‚Ä¢ Light bends when entering denser medium (air ‚Üí glass)<br>
        ‚Ä¢ Emergent ray is parallel to incident ray<br>
        ‚Ä¢ Lateral displacement occurs<br>
        <b>Formula:</b> n‚ÇÅ sin i = n‚ÇÇ sin r (Snell's Law)
      </div>
    </div>`,
  
  eye: `
    <div class="diagram">
      <h3>Human Eye Structure</h3>
      <svg viewBox="0 0 500 300" style="max-width:600px">
        <!-- Eye outline -->
        <ellipse cx="250" cy="150" rx="150" ry="100" fill="rgba(255,255,255,0.1)" stroke="#5aa6ff" stroke-width="2"/>
        <!-- Cornea -->
        <ellipse cx="150" cy="150" rx="50" ry="70" fill="rgba(90,166,255,0.3)" stroke="#5aa6ff" stroke-width="2"/>
        <!-- Pupil & Iris -->
        <circle cx="150" cy="150" r="35" fill="rgba(100,100,255,0.4)" stroke="#7c3aed" stroke-width="2"/>
        <circle cx="150" cy="150" r="18" fill="black"/>
        <!-- Lens -->
        <ellipse cx="200" cy="150" rx="20" ry="40" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="2"/>
        <!-- Retina -->
        <path d="M 330 80 Q 370 150 330 220" fill="none" stroke="#ff6b6b" stroke-width="3"/>
        <!-- Optic nerve -->
        <line x1="340" y1="150" x2="420" y2="150" stroke="#53d18c" stroke-width="4"/>
        <!-- Light rays -->
        <line x1="50" y1="130" x2="150" y2="145" stroke="yellow" stroke-width="2" opacity="0.7"/>
        <line x1="50" y1="170" x2="150" y2="155" stroke="yellow" stroke-width="2" opacity="0.7"/>
        <!-- Labels -->
        <text x="140" y="100" fill="#5aa6ff" font-size="13" font-weight="bold">Cornea</text>
        <text x="140" y="220" fill="#7c3aed" font-size="13" font-weight="bold">Iris & Pupil</text>
        <text x="200" y="120" fill="#ffb454" font-size="13" font-weight="bold">Lens</text>
        <text x="280" y="140" fill="#ff6b6b" font-size="13" font-weight="bold">Retina</text>
        <text x="350" y="140" fill="#53d18c" font-size="13" font-weight="bold">Optic Nerve</text>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>Functions:</b><br>
        ‚Ä¢ <b>Cornea:</b> Refracts light entering eye<br>
        ‚Ä¢ <b>Iris:</b> Controls pupil size<br>
        ‚Ä¢ <b>Lens:</b> Focuses light on retina (accommodation)<br>
        ‚Ä¢ <b>Retina:</b> Contains rods & cones (light-sensitive cells)<br>
        ‚Ä¢ <b>Optic Nerve:</b> Carries signals to brain
      </div>
    </div>`,
  
  circuit: `
    <div class="diagram">
      <h3>Simple Electric Circuit</h3>
      <svg viewBox="0 0 400 300" style="max-width:500px">
        <!-- Battery -->
        <line x1="50" y1="100" x2="50" y2="120" stroke="white" stroke-width="4"/>
        <line x1="50" y1="130" x2="50" y2="150" stroke="white" stroke-width="2"/>
        <text x="20" y="130" fill="#ffb454" font-size="14" font-weight="bold">Battery</text>
        <text x="20" y="145" fill="#ffb454" font-size="12">+ ‚àí</text>
        
        <!-- Wires -->
        <line x1="50" y1="100" x2="200" y2="100" stroke="#53d18c" stroke-width="3"/>
        <line x1="200" y1="100" x2="350" y2="100" stroke="#53d18c" stroke-width="3"/>
        <line x1="350" y1="100" x2="350" y2="200" stroke="#53d18c" stroke-width="3"/>
        <line x1="350" y1="200" x2="50" y2="200" stroke="#53d18c" stroke-width="3"/>
        <line x1="50" y1="200" x2="50" y2="150" stroke="#53d18c" stroke-width="3"/>
        
        <!-- Bulb -->
        <circle cx="200" cy="100" r="25" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="3"/>
        <text x="230" y="105" fill="#ffb454" font-size="14" font-weight="bold">Bulb</text>
        
        <!-- Switch -->
        <rect x="340" y="190" width="20" height="20" fill="rgba(255,107,107,0.3)" stroke="#ff6b6b" stroke-width="2"/>
        <text x="290" y="240" fill="#ff6b6b" font-size="14" font-weight="bold">Switch</text>
        
        <!-- Current direction arrows -->
        <text x="120" y="90" fill="#5aa6ff" font-size="16">‚Üí Current (I)</text>
        <text x="270" y="220" fill="#5aa6ff" font-size="16">‚Üí</text>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>Circuit Components:</b><br>
        ‚Ä¢ Battery provides voltage (V)<br>
        ‚Ä¢ Current (I) flows through circuit<br>
        ‚Ä¢ Bulb offers resistance (R)<br>
        ‚Ä¢ Switch controls the flow<br>
        <b>Ohm's Law:</b> V = I √ó R
      </div>
    </div>`,
  
  ohm: `
    <div class="diagram">
      <h3>Ohm's Law - V vs I Graph</h3>
      <svg viewBox="0 0 400 300" style="max-width:500px">
        <!-- Axes -->
        <line x1="50" y1="250" x2="350" y2="250" stroke="white" stroke-width="2" marker-end="url(#arrowhead)"/>
        <line x1="50" y1="250" x2="50" y2="50" stroke="white" stroke-width="2" marker-end="url(#arrowhead)"/>
        
        <!-- Grid -->
        <line x1="50" y1="200" x2="350" y2="200" stroke="rgba(255,255,255,0.2)" stroke-dasharray="5,5"/>
        <line x1="50" y1="150" x2="350" y2="150" stroke="rgba(255,255,255,0.2)" stroke-dasharray="5,5"/>
        <line x1="50" y1="100" x2="350" y2="100" stroke="rgba(255,255,255,0.2)" stroke-dasharray="5,5"/>
        <line x1="150" y1="250" x2="150" y2="50" stroke="rgba(255,255,255,0.2)" stroke-dasharray="5,5"/>
        <line x1="250" y1="250" x2="250" y2="50" stroke="rgba(255,255,255,0.2)" stroke-dasharray="5,5"/>
        
        <!-- Ohm's Law line -->
        <line x1="50" y1="250" x2="330" y2="70" stroke="#5aa6ff" stroke-width="4"/>
        
        <!-- Labels -->
        <text x="360" y="255" fill="white" font-size="16">I (Current) ‚Üí</text>
        <text x="15" y="40" fill="white" font-size="16">V (Voltage) ‚Üë</text>
        <text x="150" y="150" fill="#5aa6ff" font-size="18" font-weight="bold">V ‚àù I</text>
        <text x="140" y="170" fill="#5aa6ff" font-size="14">(Linear)</text>
        
        <!-- Points -->
        <circle cx="150" cy="175" r="5" fill="#ffb454"/>
        <circle cx="250" cy="100" r="5" fill="#ffb454"/>
        
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="white"/>
          </marker>
        </defs>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>Ohm's Law:</b> V = I √ó R<br>
        ‚Ä¢ Graph is a straight line passing through origin<br>
        ‚Ä¢ Slope of line = Resistance (R)<br>
        ‚Ä¢ Higher slope = Higher resistance<br>
        <b>Example:</b> If V = 10V and I = 2A, then R = 5Œ©
      </div>
    </div>`,
  
  motor: `
    <div class="diagram">
      <h3>Electric Motor (Simplified)</h3>
      <svg viewBox="0 0 400 300" style="max-width:500px">
        <!-- Magnet poles -->
        <rect x="50" y="80" width="60" height="140" fill="rgba(255,107,107,0.3)" stroke="#ff6b6b" stroke-width="3"/>
        <text x="65" y="155" fill="#ff6b6b" font-size="24" font-weight="bold">N</text>
        <rect x="290" y="80" width="60" height="140" fill="rgba(83,209,140,0.3)" stroke="#53d18c" stroke-width="3"/>
        <text x="310" y="155" fill="#53d18c" font-size="24" font-weight="bold">S</text>
        
        <!-- Coil (armature) -->
        <rect x="160" y="120" width="80" height="60" fill="rgba(90,166,255,0.2)" stroke="#5aa6ff" stroke-width="3" rx="5"/>
        <text x="175" y="155" fill="#5aa6ff" font-size="14" font-weight="bold">Coil</text>
        
        <!-- Rotation arrow -->
        <path d="M 200 100 Q 230 100 230 130" fill="none" stroke="#ffb454" stroke-width="3" marker-end="url(#arrowRotate)"/>
        <text x="235" y="110" fill="#ffb454" font-size="16">‚Üª</text>
        
        <!-- Magnetic field lines -->
        <path d="M 110 120 Q 200 110 290 120" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2" stroke-dasharray="3,3"/>
        <path d="M 110 180 Q 200 190 290 180" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2" stroke-dasharray="3,3"/>
        
        <text x="130" y="270" fill="white" font-size="14">Force on current-carrying coil</text>
        <text x="145" y="285" fill="white" font-size="14">‚Üí Rotation (Motor Effect)</text>
        
        <defs>
          <marker id="arrowRotate" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#ffb454"/>
          </marker>
        </defs>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>How it works:</b><br>
        ‚Ä¢ Current through coil in magnetic field<br>
        ‚Ä¢ Force acts on coil (Fleming's Left Hand Rule)<br>
        ‚Ä¢ Coil rotates ‚Üí Mechanical energy<br>
        ‚Ä¢ Commutator reverses current every half rotation
      </div>
    </div>`,
  
  cell: `
    <div class="diagram">
      <h3>Plant Cell vs Animal Cell</h3>
      <svg viewBox="0 0 500 300" style="max-width:650px">
        <!-- Plant Cell -->
        <rect x="30" y="30" width="200" height="240" fill="rgba(83,209,140,0.2)" stroke="#53d18c" stroke-width="3" rx="5"/>
        <text x="90" y="20" fill="#53d18c" font-size="16" font-weight="bold">Plant Cell</text>
        <!-- Cell wall -->
        <rect x="35" y="35" width="190" height="230" fill="none" stroke="#53d18c" stroke-width="2"/>
        <!-- Cell membrane -->
        <rect x="45" y="45" width="170" height="210" fill="rgba(90,166,255,0.1)" stroke="#5aa6ff" stroke-width="2" stroke-dasharray="5,5"/>
        <!-- Nucleus -->
        <circle cx="130" cy="110" r="30" fill="rgba(255,180,84,0.3)" stroke="#ffb454" stroke-width="2"/>
        <!-- Chloroplast -->
        <ellipse cx="80" cy="180" rx="20" ry="15" fill="rgba(83,209,140,0.5)" stroke="#53d18c" stroke-width="2"/>
        <ellipse cx="170" cy="190" rx="20" ry="15" fill="rgba(83,209,140,0.5)" stroke="#53d18c" stroke-width="2"/>
        <!-- Vacuole -->
        <rect x="95" y="150" width="70" height="90" fill="rgba(90,166,255,0.2)" stroke="#5aa6ff" stroke-width="2" rx="5"/>
        
        <!-- Animal Cell -->
        <ellipse cx="350" cy="150" rx="100" ry="120" fill="rgba(255,180,84,0.1)" stroke="#ffb454" stroke-width="3"/>
        <text x="305" y="20" fill="#ffb454" font-size="16" font-weight="bold">Animal Cell</text>
        <!-- Cell membrane -->
        <ellipse cx="350" cy="150" rx="95" ry="115" fill="none" stroke="#5aa6ff" stroke-width="2" stroke-dasharray="5,5"/>
        <!-- Nucleus -->
        <circle cx="350" cy="130" r="30" fill="rgba(255,180,84,0.3)" stroke="#ffb454" stroke-width="2"/>
        <!-- Small vacuoles -->
        <circle cx="320" cy="190" r="10" fill="rgba(90,166,255,0.2)" stroke="#5aa6ff" stroke-width="1"/>
        <circle cx="370" cy="200" r="8" fill="rgba(90,166,255,0.2)" stroke="#5aa6ff" stroke-width="1"/>
      </svg>
      <div class="callout" style="margin-top:12px">
        <b>Key Differences:</b><br>
        <b>Plant Cell:</b> Cell wall, Large vacuole, Chloroplasts, Regular shape<br>
        <b>Animal Cell:</b> No cell wall, Small vacuoles, No chloroplasts, Irregular shape<br>
        <b>Both have:</b> Cell membrane, Nucleus, Cytoplasm, Mitochondria
      </div>
    </div>`,
  
  heart: `
    <div class="diagram">
      <h3>Human Heart - 4 Chambers</h3>
      <svg viewBox="0 0 400 350" style="max-width:500px">
        <!-- Left Atrium -->
        <path d="M 150 80 Q 120 100 130 130 L 170 130 Q 180 100 150 80" fill="rgba(255,107,107,0.4)" stroke="#ff6b6b" stroke-width="2"/>
        <text x="125" y="115" fill="white" font-size="12" font-weight="bold">LA</text>
        
        <!-- Right Atrium -->
        <path d="M 250 80 Q 280 100 270 130 L 230 130 Q 220 100 250 80" fill="rgba(255,107,107,0.3)" stroke="#ff6b6b" stroke-width="2"/>
        <text x="245" y="115" fill="white" font-size="12" font-weight="bold">RA</text>
        
        <!-- Left Ventricle -->
        <path d="M 130 135 L 170 135 Q 180 180 150 220 Q 120 180 130 135" fill="rgba(255,107,107,0.5)" stroke="#ff6b6b" stroke-width="3"/>
        <text x="135" y="175" fill="white" font-size="12" font-weight="bold">LV</text>
        
        <!-- Right Ventricle -->
        <path d="M 230 135 L 270 135 Q 280 180 250 220 Q 220 180 230 135" fill="rgba(255,107,107,0.4)" stroke="#ff6b6b" stroke-width="3"/>
        <text x="235" y="175" fill="white" font-size="12" font-weight="bold">RV</text>
        
        <!-- Septum -->
        <line x1="200" y1="90" x2="200" y2="215" stroke="white" stroke-width="3"/>
        
        <!-- Blood vessels -->
        <path d="M 150 75 L 150 40" stroke="#5aa6ff" stroke-width="4" marker-end="url(#arrow2)"/>
        <text x="110" y="35" fill="#5aa6ff" font-size="11">Aorta</text>
        
        <path d="M 250 75 L 250 40" stroke="#a78bfa" stroke-width="4" marker-end="url(#arrow2)"/>
        <text x="255" y="35" fill="#a78bfa" font-size="11">Pulmonary</text>
        
        <path d="M 130 80 L 100 50" stroke="#a78bfa" stroke-width="3"/>
        <text x="50" y="45" fill="#a78bfa" font-size="10">From Lungs</text>
        
        <path d="M 270 80 L 300 50" stroke="#5aa6ff" stroke-width="3"/>
        <text x="305" y="45" fill="#5aa6ff" font-size="10">From Body</text>
        
        <!-- Labels -->
        <text x="320" y="120" fill="#ff6b6b" font-size="13">Atria</text>
        <text x="320" y="170" fill="#ff6b6b" font-size="13">Ventricles</text>
        
        <!-- Info box -->
        <rect x="20" y="240" width="360" height="90" fill="rgba(30,30,50,0.8)" stroke="var(--border)" stroke-width="1" rx="8"/>
        <text x="30" y="260" fill="#5aa6ff" font-size="13" font-weight="bold">Blood Flow:</text>
        <text x="30" y="280" fill="white" font-size="12">1. RA ‚Üí RV ‚Üí Lungs (get O‚ÇÇ)</text>
        <text x="30" y="295" fill="white" font-size="12">2. Lungs ‚Üí LA ‚Üí LV ‚Üí Body</text>
        <text x="30" y="315" fill="#ffb454" font-size="12"><tspan font-weight="bold">Remember:</tspan> Left side = Oxygenated (red)</text>
        
        <defs>
          <marker id="arrow2" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#5aa6ff"/>
          </marker>
        </defs>
      </svg>
    </div>`,
  
  neuron: `
    <div class="diagram">
      <h3>Neuron (Nerve Cell) Structure</h3>
      <svg viewBox="0 0 500 250" style="max-width:600px">
        <!-- Dendrites -->
        <path d="M 50 100 Q 70 80 90 100" fill="none" stroke="#a78bfa" stroke-width="2"/>
        <path d="M 50 120 Q 70 140 90 120" fill="none" stroke="#a78bfa" stroke-width="2"/>
        <path d="M 50 110 L 90 110" stroke="#a78bfa" stroke-width="2"/>
        <text x="40" y="70" fill="#a78bfa" font-size="13" font-weight="bold">Dendrites</text>
        
        <!-- Cell Body -->
        <circle cx="130" cy="110" r="35" fill="rgba(167,139,250,0.3)" stroke="#a78bfa" stroke-width="3"/>
        <circle cx="130" cy="110" r="15" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="2"/>
        <text x="115" y="115" fill="#ffb454" font-size="11" font-weight="bold">Nucleus</text>
        <text x="100" y="165" fill="#a78bfa" font-size="13" font-weight="bold">Cell Body</text>
        
        <!-- Axon -->
        <line x1="165" y1="110" x2="380" y2="110" stroke="#5aa6ff" stroke-width="8"/>
        <text x="250" y="95" fill="#5aa6ff" font-size="13" font-weight="bold">Axon</text>
        
        <!-- Myelin Sheath -->
        <rect x="200" y="100" width="40" height="20" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="2" rx="4"/>
        <rect x="260" y="100" width="40" height="20" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="2" rx="4"/>
        <rect x="320" y="100" width="40" height="20" fill="rgba(255,180,84,0.4)" stroke="#ffb454" stroke-width="2" rx="4"/>
        <text x="220" y="145" fill="#ffb454" font-size="12">Myelin Sheath</text>
        
        <!-- Axon Terminal -->
        <circle cx="400" cy="100" r="12" fill="rgba(83,209,140,0.4)" stroke="#53d18c" stroke-width="2"/>
        <circle cx="410" cy="115" r="10" fill="rgba(83,209,140,0.4)" stroke="#53d18c" stroke-width="2"/>
        <circle cx="395" cy="120" r="11" fill="rgba(83,209,140,0.4)" stroke="#53d18c" stroke-width="2"/>
        <text x="350" y="155" fill="#53d18c" font-size="13" font-weight="bold">Axon Terminal</text>
        
        <!-- Impulse direction -->
        <text x="180" y="180" fill="#ff6b6b" font-size="16">‚Üí ‚Üí ‚Üí Nerve Impulse ‚Üí ‚Üí ‚Üí</text>
        
        <!-- Info box -->
        <rect x="10" y="190" width="480" height="50" fill="rgba(30,30,50,0.9)" stroke="var(--border)" stroke-width="1" rx="8"/>
        <text x="20" y="210" fill="white" font-size="12"><tspan font-weight="bold" fill="#a78bfa">Dendrites:</tspan> Receive signals</text>
        <text x="20" y="227" fill="white" font-size="12"><tspan font-weight="bold" fill="#5aa6ff">Axon:</tspan> Transmits impulse | <tspan font-weight="bold" fill="#ffb454">Myelin:</tspan> Speeds up signal | <tspan font-weight="bold" fill="#53d18c">Terminal:</tspan> Releases neurotransmitters</text>
      </svg>
    </div>`
};

/* =========================
   MATH CONTENT
   ========================= */
const MATH_CONTENT = {
  quadratic: {
    title: "Quadratic Equations - Step by Step",
    formula: "ax¬≤ + bx + c = 0",
    solution: `
      <div class="step">
        <span class="step-num">1</span>
        <b>Standard Form:</b> ax¬≤ + bx + c = 0 (a ‚â† 0)
      </div>
      <div class="step">
        <span class="step-num">2</span>
        <b>Quadratic Formula:</b> x = [-b ¬± ‚àö(b¬≤ - 4ac)] / 2a
      </div>
      <div class="step">
        <span class="step-num">3</span>
        <b>Discriminant (D):</b> D = b¬≤ - 4ac
        <ul style="margin-top:8px">
          <li>D > 0 ‚Üí Two distinct real roots</li>
          <li>D = 0 ‚Üí Two equal real roots</li>
          <li>D < 0 ‚Üí No real roots</li>
        </ul>
      </div>`,
    example: `
      <h3>Example: Solve 2x¬≤ + 5x + 3 = 0</h3>
      <div class="step">
        <span class="step-num">1</span>
        Identify: a = 2, b = 5, c = 3
      </div>
      <div class="step">
        <span class="step-num">2</span>
        Find D: D = (5)¬≤ - 4(2)(3) = 25 - 24 = 1
      </div>
      <div class="step">
        <span class="step-num">3</span>
        Apply formula: x = [-5 ¬± ‚àö1] / 2(2) = [-5 ¬± 1] / 4
      </div>
      <div class="step">
        <span class="step-num">4</span>
        <b>Solutions:</b> x = -1 or x = -3/2
      </div>`
  },
  
  ap: {
    title: "Arithmetic Progressions (AP)",
    formula: "a, a+d, a+2d, a+3d, ...",
    solution: `
      <div class="formula-box">
        <b>Key Formulas:</b><br>
        ‚Ä¢ nth term: a‚Çô = a + (n-1)d<br>
        ‚Ä¢ Sum of n terms: S‚Çô = n/2 [2a + (n-1)d]<br>
        ‚Ä¢ Or: S‚Çô = n/2 (a + l) where l = last term
      </div>`,
    example: `
      <h3>Example: Find 10th term of AP: 2, 5, 8, 11, ...</h3>
      <div class="step">
        <span class="step-num">1</span>
        First term (a) = 2
      </div>
      <div class="step">
        <span class="step-num">2</span>
        Common difference (d) = 5 - 2 = 3
      </div>
      <div class="step">
        <span class="step-num">3</span>
        Use formula: a‚ÇÅ‚ÇÄ = a + (10-1)d
      </div>
      <div class="step">
        <span class="step-num">4</span>
        a‚ÇÅ‚ÇÄ = 2 + 9(3) = 2 + 27 = <b>29</b>
      </div>`
  },
  
  trigonometry: {
    title: "Trigonometry - Basic Ratios",
    formula: "SOH-CAH-TOA",
    solution: `
      <div class="formula-box">
        <b>Basic Ratios:</b><br>
        ‚Ä¢ sin Œ∏ = Opposite / Hypotenuse<br>
        ‚Ä¢ cos Œ∏ = Adjacent / Hypotenuse<br>
        ‚Ä¢ tan Œ∏ = Opposite / Adjacent
      </div>
      <div class="formula-box" style="margin-top:12px">
        <b>Important Identities:</b><br>
        ‚Ä¢ sin¬≤Œ∏ + cos¬≤Œ∏ = 1<br>
        ‚Ä¢ 1 + tan¬≤Œ∏ = sec¬≤Œ∏<br>
        ‚Ä¢ 1 + cot¬≤Œ∏ = cosec¬≤Œ∏
      </div>`,
    example: `
      <h3>Remember: 0¬∞, 30¬∞, 45¬∞, 60¬∞, 90¬∞</h3>
      <table style="width:100%; border-collapse:collapse; margin-top:12px">
        <tr style="background:rgba(90,166,255,0.2)">
          <th style="padding:8px; border:1px solid var(--border)">Œ∏</th>
          <th style="padding:8px; border:1px solid var(--border)">sin Œ∏</th>
          <th style="padding:8px; border:1px solid var(--border)">cos Œ∏</th>
          <th style="padding:8px; border:1px solid var(--border)">tan Œ∏</th>
        </tr>
        <tr>
          <td style="padding:8px; border:1px solid var(--border)">0¬∞</td>
          <td style="padding:8px; border:1px solid var(--border)">0</td>
          <td style="padding:8px; border:1px solid var(--border)">1</td>
          <td style="padding:8px; border:1px solid var(--border)">0</td>
        </tr>
        <tr>
          <td style="padding:8px; border:1px solid var(--border)">30¬∞</td>
          <td style="padding:8px; border:1px solid var(--border)">1/2</td>
          <td style="padding:8px; border:1px solid var(--border)">‚àö3/2</td>
          <td style="padding:8px; border:1px solid var(--border)">1/‚àö3</td>
        </tr>
        <tr>
          <td style="padding:8px; border:1px solid var(--border)">45¬∞</td>
          <td style="padding:8px; border:1px solid var(--border)">1/‚àö2</td>
          <td style="padding:8px; border:1px solid var(--border)">1/‚àö2</td>
          <td style="padding:8px; border:1px solid var(--border)">1</td>
        </tr>
        <tr>
          <td style="padding:8px; border:1px solid var(--border)">60¬∞</td>
          <td style="padding:8px; border:1px solid var(--border)">‚àö3/2</td>
          <td style="padding:8px; border:1px solid var(--border)">1/2</td>
          <td style="padding:8px; border:1px solid var(--border)">‚àö3</td>
        </tr>
        <tr>
          <td style="padding:8px; border:1px solid var(--border)">90¬∞</td>
          <td style="padding:8px; border:1px solid var(--border)">1</td>
          <td style="padding:8px; border:1px solid var(--border)">0</td>
          <td style="padding:8px; border:1px solid var(--border)">‚àû</td>
        </tr>
      </table>`
  }
};

/* =========================
   SCIENCE PRACTICE PROBLEMS
   ========================= */
const SCIENCE_PROBLEMS = [
  {
    id: "elec1",
    subject: "Physics",
    question: "Calculate the resistance of a wire if voltage across it is 12V and current through it is 3A.",
    solution: "Using Ohm's Law: V = IR<br>R = V/I = 12/3 = <b>4Œ©</b>",
    answer: "4"
  },
  {
    id: "elec2",
    subject: "Physics",
    question: "A bulb is rated 100W, 220V. Calculate the current through it when operating at rated voltage.",
    solution: "Power = Voltage √ó Current<br>I = P/V = 100/220 = <b>0.45A</b>",
    answer: "0.45"
  },
  {
    id: "light1",
    subject: "Physics",
    question: "A light ray enters from air (n=1) to glass (n=1.5) at 30¬∞. Find the angle of refraction.",
    solution: "Using Snell's Law: n‚ÇÅ sin i = n‚ÇÇ sin r<br>1 √ó sin 30¬∞ = 1.5 √ó sin r<br>sin r = 0.5/1.5 = 0.33<br>r = <b>19.5¬∞</b>",
    answer: "19.5"
  }
];

const MATH_PROBLEMS = [
  {
    id: "quad1",
    topic: "Quadratic Equations",
    question: "Solve: x¬≤ - 5x + 6 = 0",
    hint: "Try factoring or use quadratic formula",
    solution: `
      <div class="step"><span class="step-num">1</span> a=1, b=-5, c=6</div>
      <div class="step"><span class="step-num">2</span> Factor: (x-2)(x-3) = 0</div>
      <div class="step"><span class="step-num">3</span> Solutions: x = 2 or x = 3</div>`,
    answer: "2, 3"
  },
  {
    id: "ap1",
    topic: "AP",
    question: "Find the 20th term of AP: 3, 7, 11, 15, ...",
    hint: "Use a‚Çô = a + (n-1)d",
    solution: `
      <div class="step"><span class="step-num">1</span> a = 3, d = 4</div>
      <div class="step"><span class="step-num">2</span> a‚ÇÇ‚ÇÄ = 3 + (20-1)√ó4</div>
      <div class="step"><span class="step-num">3</span> a‚ÇÇ‚ÇÄ = 3 + 76 = <b>79</b></div>`,
    answer: "79"
  },
  {
    id: "trig1",
    topic: "Trigonometry",
    question: "If sin Œ∏ = 3/5, find cos Œ∏",
    hint: "Use sin¬≤Œ∏ + cos¬≤Œ∏ = 1",
    solution: `
      <div class="step"><span class="step-num">1</span> sin¬≤Œ∏ + cos¬≤Œ∏ = 1</div>
      <div class="step"><span class="step-num">2</span> (3/5)¬≤ + cos¬≤Œ∏ = 1</div>
      <div class="step"><span class="step-num">3</span> cos¬≤Œ∏ = 1 - 9/25 = 16/25</div>
      <div class="step"><span class="step-num">4</span> cos Œ∏ = <b>4/5</b></div>`,
    answer: "4/5"
  }
];

/* =========================
   CORE FUNCTIONS
   ========================= */
let STATE = initStore();

const $ = (q)=>document.querySelector(q);
const $$ = (q)=>Array.from(document.querySelectorAll(q));

function setTheme(theme){
  document.documentElement.dataset.theme = theme === "light" ? "light" : "dark";
  STATE.theme = theme;
  saveStore(STATE);
}
setTheme(STATE.theme);

function switchSubject(subject){
  CURRENT_SUBJECT = subject;
  STATE.subject = subject;
  saveStore(STATE);
  
  // Update subject tabs
  $$(".subject-tab").forEach(t => t.classList.toggle("active", t.dataset.subject === subject));
  
  // Show/hide content
  $$(".subject-content").forEach(s => s.classList.add("hidden"));
  $("#subject-" + subject).classList.remove("hidden");
  
  // Reset to overview tab
  switchTab("overview");
}

function switchTab(tab){
  CURRENT_TAB = tab;
  
  // Update tab buttons
  $$(".tab").forEach(t => t.classList.toggle("active", t.dataset.tab === tab));
  
  // Show/hide sections based on current subject
  let sections = [];
  let sectionPrefix = '';
  
  if(CURRENT_SUBJECT === 'sst'){
    sectionPrefix = 'tab-';
    sections = ["overview", "chapters", "visual", "practice", "flashcards", "quiz", "progress"];
  } else if(CURRENT_SUBJECT === 'science'){
    sectionPrefix = 'sci-';
    sections = ["overview", "chapters", "visual", "practice", "flashcards", "quiz"];
  } else if(CURRENT_SUBJECT === 'math'){
    sectionPrefix = 'math-';
    sections = ["overview", "chapters", "visual", "practice", "flashcards", "quiz"];
  }
  
  // Hide all sections in current subject
  sections.forEach(t => {
    const el = $("#" + sectionPrefix + t);
    if(el) el.classList.add("hidden");
  });
  
  // Show active section
  const activeEl = $("#" + sectionPrefix + tab);
  if(activeEl) activeEl.classList.remove("hidden");
}

/* =========================
   SCIENCE FUNCTIONS
   ========================= */
function loadDiagram(diagramKey){
  const display = $("#diagramDisplay");
  if(DIAGRAMS[diagramKey]){
    display.innerHTML = DIAGRAMS[diagramKey];
  }
}

function loadScienceChapter(chapter){
  const content = $("#sciChapterContent");
  const chapters = {
    light: `
      <div class="card">
        <h3>Light - Reflection & Refraction</h3>
        <div class="formula-box">
          <b>Laws of Refraction:</b><br>
          ‚Ä¢ n‚ÇÅ sin i = n‚ÇÇ sin r (Snell's Law)<br>
          ‚Ä¢ Refractive index: n = c/v = sin i / sin r
        </div>
        <div class="callout">
          <b>Key Concepts:</b><br>
          ‚Ä¢ Light travels in straight lines<br>
          ‚Ä¢ Bends when changing medium<br>
          ‚Ä¢ Denser to rarer ‚Üí bends away from normal<br>
          ‚Ä¢ Rarer to denser ‚Üí bends towards normal
        </div>
      </div>`,
    electricity: `
      <div class="card">
        <h3>Electricity</h3>
        <div class="formula-box">
          <b>Important Formulas:</b><br>
          ‚Ä¢ V = IR (Ohm's Law)<br>
          ‚Ä¢ P = VI = I¬≤R = V¬≤/R<br>
          ‚Ä¢ H = I¬≤Rt (Heating effect)
        </div>
        <div class="concept-map">
          <div class="concept-node">Voltage (V)</div>
          <span class="concept-arrow">‚Üí</span>
          <div class="concept-node">Current (I)</div>
          <span class="concept-arrow">‚Üí</span>
          <div class="concept-node">Resistance (R)</div>
        </div>
      </div>`,
    life: `
      <div class="card">
        <h3>Life Processes</h3>
        <div class="concept-map">
          <div class="concept-node">Nutrition</div>
          <div class="concept-node">Respiration</div>
          <div class="concept-node">Transportation</div>
          <div class="concept-node">Excretion</div>
        </div>
        <div class="callout" style="margin-top:16px">
          <b>Remember:</b> All living organisms need energy and materials to stay alive!
        </div>
      </div>`
  };
  content.innerHTML = chapters[chapter] || "<div class='muted'>Select a chapter</div>";
}

function loadSciencePractice(){
  const area = $("#sciPracticeArea");
  let html = "";
  SCIENCE_PROBLEMS.forEach((p, idx) => {
    html += `
      <div class="problem">
        <div class="small" style="color:var(--science)"><b>${p.subject}</b></div>
        <div style="font-weight:600; margin-top:6px"><b>Q${idx+1}.</b> ${p.question}</div>
        <input type="text" class="problem-input" id="ans-${p.id}" placeholder="Your answer"/>
        <button class="btn good" onclick="checkScienceAnswer('${p.id}', ${idx})">Check Answer</button>
        <div id="solution-${p.id}" class="hidden" style="margin-top:10px; padding:10px; background:rgba(83,209,140,0.1); border-radius:8px">
          ${p.solution}
        </div>
      </div>`;
  });
  area.innerHTML = html;
}

function checkScienceAnswer(id, idx){
  const userAns = $("#ans-" + id).value.trim();
  const problem = SCIENCE_PROBLEMS[idx];
  const solutionDiv = $("#solution-" + id);
  
  solutionDiv.classList.remove("hidden");
  
  if(userAns === problem.answer || Math.abs(parseFloat(userAns) - parseFloat(problem.answer)) < 0.1){
    solutionDiv.style.background = "rgba(83,209,140,0.2)";
    solutionDiv.innerHTML = "‚úÖ Correct! " + problem.solution;
  } else {
    solutionDiv.style.background = "rgba(255,107,107,0.2)";
    solutionDiv.innerHTML = "‚ùå Try again. <br><br><b>Solution:</b><br>" + problem.solution;
  }
}

/* =========================
   MATH FUNCTIONS
   ========================= */
function loadMathChapter(chapter){
  const content = $("#mathChapterContent");
  const data = {
    quadratic: MATH_CONTENT.quadratic,
    ap: MATH_CONTENT.ap,
    trigonometry: MATH_CONTENT.trigonometry
  };
  
  if(data[chapter]){
    const d = data[chapter];
    content.innerHTML = `
      <div class="card">
        <h2>${d.title}</h2>
        <div class="formula-box">
          <b>Main Formula:</b> ${d.formula}
        </div>
        ${d.solution}
        <div class="divider"></div>
        ${d.example}
      </div>`;
  } else {
    content.innerHTML = `<div class="card"><h3>Chapter: ${chapter}</h3><div class="muted">Content coming soon...</div></div>`;
  }
}

function loadMathPractice(topic){
  const area = $("#mathPracticeArea");
  const problems = MATH_PROBLEMS.filter(p => 
    topic === "quadratic" ? p.topic === "Quadratic Equations" :
    topic === "ap" ? p.topic === "AP" :
    topic === "trigonometry" ? p.topic === "Trigonometry" : false
  );
  
  let html = "";
  problems.forEach((p, idx) => {
    html += `
      <div class="problem">
        <div class="small" style="color:var(--math)"><b>${p.topic}</b></div>
        <div style="font-weight:600; margin-top:6px"><b>Q${idx+1}.</b> ${p.question}</div>
        <div class="small muted"style="margin-top:4px">üí° Hint: ${p.hint}</div>
        <input type="text" class="problem-input" id="math-ans-${p.id}" placeholder="Your answer"/>
        <button class="btn good" onclick="checkMathAnswer('${p.id}', ${MATH_PROBLEMS.indexOf(p)})">Check Answer</button>
        <div id="math-solution-${p.id}" class="hidden" style="margin-top:10px"></div>
      </div>`;
  });
  area.innerHTML = html || "<div class='muted'>No problems available for this topic</div>";
}

function checkMathAnswer(id, idx){
  const userAns = $("#math-ans-" + id).value.trim();
  const problem = MATH_PROBLEMS[idx];
  const solutionDiv = $("#math-solution-" + id);
  
  solutionDiv.classList.remove("hidden");
  
  if(userAns === problem.answer){
    solutionDiv.style.background = "rgba(83,209,140,0.2)";
    solutionDiv.style.padding = "12px";
    solutionDiv.style.borderRadius = "8px";
    solutionDiv.innerHTML = "‚úÖ <b>Correct!</b><br><br><b>Solution:</b>" + problem.solution;
  } else {
    solutionDiv.style.background = "rgba(255,107,107,0.2)";
    solutionDiv.style.padding = "12px";
    solutionDiv.style.borderRadius = "8px";
    solutionDiv.innerHTML = "‚ùå <b>Not quite.</b><br><br><b>Solution:</b>" + problem.solution;
  }
}

function loadMathVisual(){
  const area = $("#mathVisualArea");
  area.innerHTML = `
    <div class="card">
      <h3>Quadratic Function Graph</h3>
      <div class="diagram">
        <svg viewBox="0 0 400 300" style="max-width:500px">
          <!-- Axes -->
          <line x1="200" y1="20" x2="200" y2="280" stroke="white" stroke-width="2"/>
          <line x1="20" y1="150" x2="380" y2="150" stroke="white" stroke-width="2"/>
          <!-- Parabola y = x¬≤ -->
          <path d="M 100 250 Q 200 50 300 250" fill="none" stroke="#5aa6ff" stroke-width="3"/>
          <!-- Labels -->
          <text x="210" y="40" fill="white" font-size="14">y</text>
          <text x="360" y="140" fill="white" font-size="14">x</text>
          <text x="180" y="70" fill="#5aa6ff" font-size="16" font-weight="bold">y = x¬≤</text>
          <!-- Origin -->
          <circle cx="200" cy="150" r="4" fill="#ffb454"/>
          <text x="210" y="165" fill="#ffb454" font-size="12">(0,0)</text>
        </svg>
      </div>
      <div class="formula-box">
        <b>Standard Form:</b> y = ax¬≤ + bx + c<br>
        ‚Ä¢ If a > 0: Opens upward (‚à™)<br>
        ‚Ä¢ If a < 0: Opens downward (‚à©)<br>
        ‚Ä¢ Vertex formula: x = -b/2a
      </div>
    </div>`;
}

/* =========================
   INITIALIZATION & WIRING
   ========================= */
// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
  
buildAnchors();
buildCheatSheet();
buildChapterFilter();
buildChapters();
buildTimeline();
updateBoxesUI();
updateStreakUI();

// Subject tabs
$$(".subject-tab").forEach(t => t.addEventListener("click", () => switchSubject(t.dataset.subject)));

// Feature tabs
$$(".tab").forEach(t => t.addEventListener("click", () => switchTab(t.dataset.tab)));

// Theme
$("#themeBtn").addEventListener("click", ()=>{
  setTheme((STATE.theme||"dark")==="dark" ? "light" : "dark");
});

// Reset
$("#resetBtn").addEventListener("click", ()=>{
  if(!confirm("Reset saved progress?")) return;
  localStorage.removeItem(STORE_KEY);
  location.reload();
});

// SST features
$("#chapterSearch").addEventListener("input", buildChapters);
$("#chapterFilter").addEventListener("change", buildChapters);
$("#timeFilter").addEventListener("change", buildTimeline);
$("#timeSearch").addEventListener("input", buildTimeline);
$("#deckSelect").addEventListener("change", rebuildOrder);
$("#shuffleBtn").addEventListener("click", rebuildOrder);

const fcEl = $("#flashcard");
if(fcEl){
  function toggleReveal(){ fcEl.classList.toggle("revealed"); }
  fcEl.addEventListener("click", toggleReveal);
  fcEl.addEventListener("keydown", (e)=>{
    if(e.key===" " || e.key==="Enter"){ e.preventDefault(); toggleReveal(); }
  });
}

if($("#rateAgain")) $("#rateAgain").addEventListener("click", ()=>rateCard("again"));
if($("#rateHard")) $("#rateHard").addEventListener("click", ()=>rateCard("hard"));
if($("#rateGood")) $("#rateGood").addEventListener("click", ()=>rateCard("good"));
if($("#rateEasy")) $("#rateEasy").addEventListener("click", ()=>rateCard("easy"));

document.addEventListener("keydown", (e)=>{
  const fcTab = $("#tab-flashcards");
  if(fcTab && !fcTab.classList.contains("hidden")){
    if(e.key==="ArrowRight") nextCard();
    if(e.key.toLowerCase()==="a") rateCard("again");
    if(e.key.toLowerCase()==="h") rateCard("hard");
    if(e.key.toLowerCase()==="g") rateCard("good");
    if(e.key.toLowerCase()==="e") rateCard("easy");
  }
});

if($("#newQuizBtn")) $("#newQuizBtn").addEventListener("click", ()=>makeQuiz($("#quizFilter").value, 10));
if($("#submitQuizBtn")) $("#submitQuizBtn").addEventListener("click", gradeQuiz);

// Science event listeners
if($("#diagramSelect")) {
  $("#diagramSelect").addEventListener("change", (e) => loadDiagram(e.target.value));
  loadDiagram("refraction"); // Load first diagram by default
}

if($("#sciChapterSelect")) {
  $("#sciChapterSelect").addEventListener("change", (e) => loadScienceChapter(e.target.value));
}

// Load initial content for Science practice
if($("#sciPracticeArea")) {
  loadSciencePractice();
}

// Math visual
if($("#mathVisualArea")) {
  loadMathVisual();
}

// Load initial math practice
if($("#mathPracticeArea")) {
  loadMathPractice("quadratic");
}

// Init flashcards and quiz
rebuildOrder();
makeQuiz($("#quizFilter")?.value || "ALL", 10);

// Start with SST subject
switchSubject(STATE.subject || 'sst');

}); // End DOMContentLoaded
</script>
</body>
</html>
