<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Class 10 History ‚Ä¢ QuickLearn (NCERT: India and the Contemporary World‚ÄìII)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --muted:#9aa7c7; --text:#e7ecff;
      --accent:#5aa6ff; --accent2:#ffb454; --good:#53d18c; --bad:#ff6b6b;
      --border:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --card:#ffffff; --muted:#51607d; --text:#111827;
      --accent:#2563eb; --accent2:#b45309; --good:#15803d; --bad:#b91c1c;
      --border:rgba(17,24,39,.12);
      --shadow: 0 10px 30px rgba(17,24,39,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text); background:radial-gradient(1200px 800px at 15% 10%, rgba(90,166,255,.25), transparent 60%),
      radial-gradient(1000px 700px at 90% 30%, rgba(255,180,84,.18), transparent 60%),
      var(--bg);
      min-height:100vh;
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--bg) 82%, transparent);
      border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px;}
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    h1{
      margin:0; font-size:18px; letter-spacing:.2px;
    }
    .sub{color:var(--muted); font-size:13px; margin-top:3px}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    button, .pill, input, select{
      font: inherit;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px; border:1px solid var(--border);
      border-radius:999px; background:color-mix(in oklab, var(--card) 88%, transparent);
      box-shadow: var(--shadow);
    }
    .pill small{color:var(--muted)}
    .btn{
      cursor:pointer; border:1px solid var(--border);
      background:color-mix(in oklab, var(--card) 92%, transparent);
      color:var(--text); padding:9px 12px; border-radius:12px;
      box-shadow: var(--shadow);
      transition: transform .06s ease;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color: color-mix(in oklab, var(--accent) 60%, var(--border));}
    .btn.good{border-color: color-mix(in oklab, var(--good) 60%, var(--border));}
    .btn.bad{border-color: color-mix(in oklab, var(--bad) 60%, var(--border));}
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:14px;
    }
    .tab{
      cursor:pointer;
      padding:9px 12px; border-radius:999px;
      border:1px solid var(--border);
      background:transparent; color:var(--text);
      opacity:.9;
    }
    .tab.active{
      background: color-mix(in oklab, var(--accent) 18%, transparent);
      border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
      opacity:1;
    }
    main{padding:18px 0 40px;}
    .grid{display:grid; gap:14px;}
    @media(min-width:900px){ .grid.cols2{grid-template-columns: 1.1fr .9fr;} }
    .card{
      background: color-mix(in oklab, var(--card) 92%, transparent);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:16px}
    .muted{color:var(--muted)}
    .kpi{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
    .kpi .box{
      padding:10px 12px; border-radius:14px; border:1px solid var(--border);
      background: color-mix(in oklab, var(--card) 90%, transparent);
      min-width:150px;
    }
    .kpi .big{font-family:var(--mono); font-size:18px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .row > *{flex:0 0 auto}
    input[type="search"], select{
      padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background: transparent; color:var(--text);
      min-width: 220px;
    }
    details{
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      background: color-mix(in oklab, var(--card) 88%, transparent);
    }
    details + details{margin-top:10px}
    summary{
      cursor:pointer; font-weight:600;
      list-style:none;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .tag{
      font-size:12px; color:var(--muted);
      border:1px solid var(--border);
      padding:3px 8px; border-radius:999px;
    }
    ul{margin:8px 0 0 18px}
    li{margin:4px 0}
    .two{
      display:grid; gap:10px;
      grid-template-columns: 1fr;
    }
    @media(min-width:800px){ .two{grid-template-columns: 1fr 1fr;} }
    .timeline{
      display:flex; gap:10px; overflow:auto; padding-bottom:6px;
      scroll-snap-type: x mandatory;
    }
    .event{
      scroll-snap-align:start;
      min-width:260px;
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
    }
    .event .year{font-family:var(--mono); color:var(--accent); font-size:16px}
    .event .title{font-weight:700; margin-top:6px}
    .event .meta{color:var(--muted); font-size:12px; margin-top:6px}
    .fc{
      display:grid; gap:12px; align-items:stretch;
    }
    @media(min-width:900px){ .fc{grid-template-columns: 1.1fr .9fr;} }
    .flashcard{
      min-height:240px;
      border:1px solid var(--border);
      border-radius:18px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
      box-shadow: var(--shadow);
      padding:14px;
      display:flex; flex-direction:column; justify-content:space-between;
      cursor:pointer;
    }
    .flashcard .front{font-size:18px; font-weight:700; line-height:1.3}
    .flashcard .back{display:none; margin-top:10px; color:var(--muted); line-height:1.5}
    .flashcard.revealed .back{display:block}
    .flashcard .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .flashcard .chips span{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--border); color:var(--muted);
    }
    .quizQ{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: color-mix(in oklab, var(--card) 90%, transparent);
      margin-top:10px;
    }
    .opt{
      display:block; margin-top:8px; padding:10px 12px;
      border:1px solid var(--border); border-radius:12px;
      cursor:pointer;
    }
    .opt.correct{border-color: color-mix(in oklab, var(--good) 60%, var(--border));}
    .opt.wrong{border-color: color-mix(in oklab, var(--bad) 60%, var(--border)); opacity:.95;}
    .small{font-size:12px; color:var(--muted)}
    .footer-note{color:var(--muted); font-size:12px; margin-top:10px; line-height:1.4}
    .divider{height:1px; background:var(--border); margin:12px 0}
    .hidden{display:none !important;}
    .callout{
      border-left:4px solid color-mix(in oklab, var(--accent) 60%, var(--border));
      padding:10px 12px; border-radius:12px; background: color-mix(in oklab, var(--card) 88%, transparent);
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>Class 10 History ‚Ä¢ QuickLearn</h1>
        <div class="sub">NCERT: <span class="muted">India and the Contemporary World‚ÄìII</span> ‚Ä¢ fast summaries + timelines + flashcards + quiz</div>
      </div>
      <div class="controls">
        <div class="pill" title="Your progress is saved locally in this browser (localStorage).">
          <div><strong id="streak">0</strong> day streak</div>
          <small>practice</small>
        </div>
        <button class="btn" id="resetBtn" title="Reset saved progress">Reset</button>
        <button class="btn primary" id="themeBtn" title="Toggle light/dark">Theme</button>
      </div>
    </div>
    <div class="tabs" role="tablist" aria-label="QuickLearn Tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="chapters">Chapters</button>
      <button class="tab" data-tab="timeline">Timeline</button>
      <button class="tab" data-tab="flashcards">Flashcards</button>
      <button class="tab" data-tab="quiz">Quiz</button>
      <button class="tab" data-tab="progress">Progress</button>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- OVERVIEW -->
  <section id="tab-overview">
    <div class="grid cols2">
      <div class="card">
        <h2>How to use (10‚Äì15 min/day)</h2>
        <ol>
          <li><b>Read ‚Äú60‚Äësecond story‚Äù</b> for a chapter.</li>
          <li><b>Timeline scroll</b> (focus on 8‚Äì12 key years).</li>
          <li><b>Flashcards</b>: tap to reveal ‚Üí rate (Again/Hard/Good/Easy).</li>
          <li><b>Quiz</b>: do 10 mixed questions; repeat weak areas.</li>
        </ol>
        <div class="callout">
          <b>Memory hack:</b> Don‚Äôt try to memorize every date. Memorize <b>anchor years</b> + the story around them.
          This app highlights the anchor years repeatedly.
        </div>
        <div class="footer-note">Note: Content is condensed for exam revision. If your school uses extra chapters/editions, you can add more cards/events in the <span style="font-family:var(--mono)">DATA</span> section of the HTML.</div>
      </div>

      <div class="card">
        <h2>Quick anchors (the ‚Äúmust-know‚Äù years)</h2>
        <div class="two" id="anchorList"></div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>One-page cheat sheet (super short)</h2>
      <div class="two" id="cheatSheet"></div>
    </div>
  </section>

  <!-- CHAPTERS -->
  <section id="tab-chapters" class="hidden">
    <div class="row" style="margin-bottom:10px">
      <input id="chapterSearch" type="search" placeholder="Search people / places / keywords (e.g., 'Dandi', 'Vienna')" />
      <select id="chapterFilter">
        <option value="ALL">All chapters</option>
      </select>
    </div>
    <div id="chapterAccordions"></div>
  </section>

  <!-- TIMELINE -->
  <section id="tab-timeline" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Timeline (scroll sideways)</h2>
        <select id="timeFilter">
          <option value="ALL">All chapters</option>
        </select>
        <input id="timeSearch" type="search" placeholder="Search timeline (e.g., 1919, 'WWI', 'Germany')" />
      </div>
      <div class="divider"></div>
      <div class="timeline" id="timelineStrip"></div>
      <div class="footer-note">Tip: Focus first on the events marked <b>Anchor</b>. Those are the easiest ‚Äúexam points‚Äù.</div>
    </div>
  </section>

  <!-- FLASHCARDS -->
  <section id="tab-flashcards" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Flashcards (tap to reveal)</h2>
        <select id="deckSelect"></select>
        <button class="btn" id="shuffleBtn">Shuffle</button>
      </div>
      <div class="divider"></div>

      <div class="fc">
        <div class="flashcard" id="flashcard" tabindex="0" role="button" aria-label="Flashcard (tap to reveal)">
          <div>
            <div class="small" id="fcMeta">Deck ‚Ä¢ Card</div>
            <div class="front" id="fcFront">‚Äî</div>
            <div class="back" id="fcBack">‚Äî</div>
            <div class="chips" id="fcChips"></div>
          </div>
          <div class="small">Tap/click to reveal ‚Ä¢ Spacebar also works</div>
        </div>

        <div class="card" style="padding:12px">
          <h2>Rate your recall</h2>
          <div class="small">This uses a simple ‚ÄúLeitner box‚Äù system and saves progress in this browser.</div>
          <div class="divider"></div>
          <div class="row" style="gap:8px">
            <button class="btn bad" id="rateAgain">Again</button>
            <button class="btn" id="rateHard">Hard</button>
            <button class="btn good" id="rateGood">Good</button>
            <button class="btn primary" id="rateEasy">Easy</button>
          </div>
          <div class="divider"></div>
          <div class="kpi">
            <div class="box"><div class="big" id="box1">0</div><div class="muted">Box 1 (new)</div></div>
            <div class="box"><div class="big" id="box2">0</div><div class="muted">Box 2</div></div>
            <div class="box"><div class="big" id="box3">0</div><div class="muted">Box 3</div></div>
            <div class="box"><div class="big" id="box4">0</div><div class="muted">Box 4 (mastered)</div></div>
          </div>
          <div class="footer-note">Rule of thumb: if you can say the answer confidently in <b>5 seconds</b>, press <b>Easy</b>.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="tab-quiz" class="hidden">
    <div class="card">
      <div class="row">
        <h2 style="margin-right:auto">Quiz (10 questions)</h2>
        <select id="quizFilter">
          <option value="ALL">All chapters</option>
        </select>
        <button class="btn primary" id="newQuizBtn">New Quiz</button>
      </div>
      <div class="divider"></div>
      <div id="quizArea"></div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn good" id="submitQuizBtn">Submit</button>
        <div class="pill"><div><b id="quizScore">0/0</b></div><small>score</small></div>
      </div>
      <div class="footer-note">Quiz questions are generated from the same knowledge cards (so reviewing flashcards boosts quiz score quickly).</div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section id="tab-progress" class="hidden">
    <div class="grid cols2">
      <div class="card">
        <h2>Progress snapshot</h2>
        <div class="kpi">
          <div class="box"><div class="big" id="pTotal">0</div><div class="muted">Total cards</div></div>
          <div class="box"><div class="big" id="pMastered">0</div><div class="muted">Mastered (Box 4)</div></div>
          <div class="box"><div class="big" id="pWeak">0</div><div class="muted">Weak (Box 1)</div></div>
        </div>
        <div class="divider"></div>
        <div class="small">Tip: If time is short, focus on <b>Box 1 + Anchor years</b>.</div>
      </div>
      <div class="card">
        <h2>What to memorize for exams</h2>
        <ul>
          <li><b>People + role</b> (who did what?)</li>
          <li><b>Places + why important</b> (where did it happen?)</li>
          <li><b>Cause ‚Üí event ‚Üí result</b> (the ‚Äústory chain‚Äù)</li>
          <li><b>Anchor years</b> (not every date)</li>
        </ul>
        <div class="callout">
          <b>Fast answer format (3 lines):</b><br>
          1) Context/cause<br>
          2) Main event/action<br>
          3) Result/impact
        </div>
      </div>
    </div>
  </section>
</main>

<script>
/* =========================
   DATA (edit here to add more)
   ========================= */
const CHAPTERS = [
  {id:"EU", title:"1. The Rise of Nationalism in Europe"},
  {id:"IN", title:"2. Nationalism in India"},
  {id:"GW", title:"3. The Making of a Global World"},
  {id:"AI", title:"4. The Age of Industrialisation"},
  {id:"PC", title:"5. Print Culture and the Modern World"},
];

// Timeline events (very condensed)
const EVENTS = [
  // Europe
  {id:"EU1789", chapter:"EU", year:"1789", anchor:true, title:"French Revolution", detail:"Ideas of liberty, equality, fraternity ‚Üí nationalism grows.", people:["French revolutionaries"], places:["France"], tags:["politics"]},
  {id:"EU1815", chapter:"EU", year:"1815", anchor:true, title:"Congress of Vienna", detail:"Conservatives restore monarchies; redraw Europe after Napoleon.", people:["Metternich"], places:["Vienna"], tags:["politics"]},
  {id:"EU1830", chapter:"EU", year:"1830", anchor:true, title:"Revolutions of 1830", detail:"France (July Revolution); Belgium becomes independent.", people:["Revolutionaries"], places:["France","Belgium"], tags:["politics"]},
  {id:"EU1848", chapter:"EU", year:"1848", anchor:true, title:"Revolutions of 1848", detail:"Liberals demand constitutions; Frankfurt Parliament tries German unity.", people:["Liberals"], places:["German states","Frankfurt"], tags:["politics"]},
  {id:"EU1861", chapter:"EU", year:"1861", anchor:true, title:"Unification of Italy", detail:"King Victor Emmanuel II becomes king of united Italy.", people:["Cavour","Garibaldi","Victor Emmanuel II"], places:["Italy"], tags:["politics"]},
  {id:"EU1871", chapter:"EU", year:"1871", anchor:true, title:"Unification of Germany", detail:"German empire proclaimed after victory over France.", people:["Bismarck","Kaiser William I"], places:["Germany","Versailles"], tags:["politics"]},

  // India
  {id:"IN1915", chapter:"IN", year:"1915", anchor:true, title:"Gandhi returns to India", detail:"Brings satyagraha methods from South Africa.", people:["M.K. Gandhi"], places:["India"], tags:["politics"]},
  {id:"IN1917", chapter:"IN", year:"1917", anchor:true, title:"Champaran Satyagraha", detail:"Indigo peasants; Gandhi‚Äôs early success in India.", people:["M.K. Gandhi"], places:["Champaran (Bihar)"], tags:["movement"]},
  {id:"IN1919", chapter:"IN", year:"1919", anchor:true, title:"Rowlatt Act & Jallianwala Bagh", detail:"Repression sparks mass anger; turning point in national movement.", people:["General Dyer"], places:["Amritsar"], tags:["movement"]},
  {id:"IN1920", chapter:"IN", year:"1920", anchor:true, title:"Non‚ÄëCooperation begins", detail:"Boycott British institutions; linked with Khilafat.", people:["Gandhi","Ali brothers"], places:["Across India"], tags:["movement"]},
  {id:"IN1922", chapter:"IN", year:"1922", anchor:true, title:"Chauri Chaura", detail:"Violence ‚Üí Gandhi withdraws Non‚ÄëCooperation.", people:["Gandhi"], places:["Chauri Chaura (UP)"], tags:["movement"]},
  {id:"IN1930", chapter:"IN", year:"1930", anchor:true, title:"Civil Disobedience & Dandi March", detail:"Salt law broken; mass participation.", people:["Gandhi"], places:["Dandi"], tags:["movement"]},
  {id:"IN1931", chapter:"IN", year:"1931", anchor:false, title:"Gandhi‚ÄëIrwin Pact", detail:"CDM suspended; Gandhi attends Round Table Conference.", people:["Gandhi","Lord Irwin"], places:["Delhi/London"], tags:["politics"]},
  {id:"IN1932", chapter:"IN", year:"1932", anchor:true, title:"Poona Pact", detail:"Agreement on representation of depressed classes.", people:["B.R. Ambedkar","Gandhi"], places:["Poona"], tags:["society"]},
  {id:"IN1942", chapter:"IN", year:"1942", anchor:true, title:"Quit India Movement", detail:"‚ÄòDo or Die‚Äô call; mass upsurge against British rule.", people:["Gandhi"], places:["India"], tags:["movement"]},

  // Global world
  {id:"GW1492", chapter:"GW", year:"1492", anchor:false, title:"Columbus reaches Americas", detail:"Start of European expansion; reshapes world trade.", people:["Columbus"], places:["Americas"], tags:["trade"]},
  {id:"GW1800s", chapter:"GW", year:"1800s", anchor:true, title:"Indentured labour migration", detail:"Workers sent to plantations (Caribbean, Fiji, Mauritius) after slavery declines.", people:["Indentured labourers"], places:["Caribbean","Fiji","Mauritius"], tags:["migration"]},
  {id:"GW1914", chapter:"GW", year:"1914‚Äì18", anchor:true, title:"First World War", detail:"War economy + disruption in trade; affects colonies too.", people:["Allied/Axis powers"], places:["Europe/World"], tags:["war"]},
  {id:"GW1929", chapter:"GW", year:"1929", anchor:true, title:"Great Depression", detail:"World demand collapses; farmers & workers suffer worldwide.", people:["‚Äî"], places:["USA/World"], tags:["economy"]},
  {id:"GW1945", chapter:"GW", year:"1945", anchor:false, title:"Post‚Äëwar world economy", detail:"Reconstruction; new institutions; decolonisation accelerates.", people:["‚Äî"], places:["World"], tags:["economy"]},

  // Industrialisation
  {id:"AI1700s", chapter:"AI", year:"1700s", anchor:true, title:"Industrial Revolution (Britain)", detail:"Factories, machines, and new labour systems expand.", people:["Inventors/industrialists"], places:["Britain"], tags:["industry"]},
  {id:"AI1850s", chapter:"AI", year:"1850s", anchor:false, title:"Railways & steamships expand trade", detail:"Faster transport connects markets; spreads industrial goods.", people:["‚Äî"], places:["Europe/India"], tags:["trade"]},
  {id:"AI1900", chapter:"AI", year:"1900", anchor:true, title:"Indian factories grow", detail:"Cotton/jute industries expand; Indian entrepreneurs rise.", people:["Indian industrialists"], places:["Bombay/Calcutta"], tags:["industry"]},

  // Print culture
  {id:"PC1450", chapter:"PC", year:"1450s", anchor:true, title:"Gutenberg printing press", detail:"Print becomes cheaper ‚Üí knowledge spreads faster in Europe.", people:["Johannes Gutenberg"], places:["Germany"], tags:["culture"]},
  {id:"PC1517", chapter:"PC", year:"1517", anchor:false, title:"Reformation & print", detail:"Print helps spread new religious ideas across Europe.", people:["Martin Luther"], places:["Europe"], tags:["culture"]},
  {id:"PC1700s", chapter:"PC", year:"1700s", anchor:true, title:"Enlightenment & newspapers", detail:"Public debate grows; ideas of rights & citizenship spread.", people:["Philosophers"], places:["Europe"], tags:["culture"]},
  {id:"PC1800sIN", chapter:"PC", year:"1800s", anchor:true, title:"Print in India expands", detail:"Vernacular press, novels, textbooks; social reform debates.", people:["Indian writers/reformers"], places:["Calcutta/Bombay/Madras"], tags:["culture"]},
];

/* Flashcards: Front = question; Back = short answer + ‚Äúwhy it matters‚Äù + mnemonic */
const CARDS = [
  // Europe
  {id:"cEU1", chapter:"EU", front:"1789: What happened and why is it important for nationalism?", back:"French Revolution: people demand rights + citizenship. It spreads the idea that a nation is made of citizens (not just kings).  \nMnemonic: '89 = Revolution‚Äôs gate.'", tags:["1789","France","nationalism"], year:"1789"},
  {id:"cEU2", chapter:"EU", front:"1815: Congress of Vienna ‚Äî what was its goal?", back:"To restore old monarchies + create balance of power after Napoleon; conservatives try to stop revolutionary nationalism.  \nAnchor: Vienna = 'V' for 'Very conservative'.", tags:["1815","Vienna","Metternich"], year:"1815"},
  {id:"cEU3", chapter:"EU", front:"1848: Frankfurt Parliament tried to do what?", back:"Create a unified German nation with a constitution, but failed (king rejected crown; divisions).  \nExam line: ‚ÄòLiberal nationalism rose but was crushed.‚Äô", tags:["1848","Frankfurt","Germany"], year:"1848"},
  {id:"cEU4", chapter:"EU", front:"1871: How did Germany unify?", back:"Prussia under Bismarck used wars + diplomacy; German Empire proclaimed (symbol of strong nationalism).  \nMnemonic: '71 = Germany becomes ONE.'", tags:["1871","Bismarck","Germany"], year:"1871"},

  // India
  {id:"cIN1", chapter:"IN", front:"1919: Why is Jallianwala Bagh a turning point?", back:"British troops killed unarmed people in Amritsar ‚Üí mass anger; trust in British rule collapses; nationalism spreads deeper.  \nAnchor: 1919 = ‚Äò19 = blood-stained line‚Äô.", tags:["1919","Amritsar","Jallianwala"], year:"1919"},
  {id:"cIN2", chapter:"IN", front:"1920: What is Non‚ÄëCooperation? Give 2 examples.", back:"Mass boycott of British institutions to win swaraj: (1) leave govt jobs/schools/courts, (2) boycott foreign cloth, promote khadi/swadeshi.  \n3-line answer: cause (Rowlatt/Jallianwala) ‚Üí boycott ‚Üí impact (mass politics).", tags:["1920","boycott","khadi"], year:"1920"},
  {id:"cIN3", chapter:"IN", front:"1930: Why did Gandhi choose salt for Civil Disobedience?", back:"Salt tax affected everyone (rich/poor). Breaking salt law was a simple, powerful symbol of injustice.  \nMnemonic: ‚ÄòSalt = small thing, big fight.‚Äô", tags:["1930","Dandi","salt"], year:"1930"},
  {id:"cIN4", chapter:"IN", front:"1942: What is the message of Quit India?", back:"‚ÄòDo or Die‚Äô‚ÄîBritish must leave immediately; mass protests despite repression.  \nAnchor: 42 = ‚Äòfinal push‚Äô phase.", tags:["1942","Quit India"], year:"1942"},

  // Global world
  {id:"cGW1", chapter:"GW", front:"What is ‚Äòglobalisation‚Äô in this chapter (simple meaning)?", back:"Growing connections between countries through trade, migration, capital, and ideas (a world becoming linked).", tags:["trade","migration"]},
  {id:"cGW2", chapter:"GW", front:"1929: How did the Great Depression hurt India?", back:"Prices & demand fell ‚Üí farmers got less for crops; unemployment rose; colonial economy worsened poverty.  \nAnchor: 1929 = ‚Äòworld demand dies‚Äô.", tags:["1929","depression","India"], year:"1929"},

  // Industrialisation
  {id:"cAI1", chapter:"AI", front:"What is ‚Äòindustrialisation‚Äô?", back:"Shift from hand production to machine + factory production; big change in labour, transport, and markets.", tags:["factories","machines"]},
  {id:"cAI2", chapter:"AI", front:"Why did handloom weaving survive (even with factories)?", back:"Demand for fine designs; adaptation; some consumers preferred hand-made cloth; also factory cloth wasn‚Äôt always suitable.  \nExam keyword: ‚Äòflexibility + niche markets‚Äô.", tags:["handloom","weavers"]},

  // Print culture
  {id:"cPC1", chapter:"PC", front:"1450s: Why is Gutenberg important?", back:"He made printing faster/cheaper ‚Üí books & ideas spread widely ‚Üí helped Reformation, Enlightenment, and modern public opinion.", tags:["1450s","Gutenberg","press"], year:"1450s"},
  {id:"cPC2", chapter:"PC", front:"How did print help nationalism?", back:"Newspapers + novels created a shared language/ideas; people imagined themselves as one community.  \nPhrase: ‚ÄòPrint made a public‚Äô ‚Üí ‚Äòpublic made a nation‚Äô.", tags:["newspapers","novels","nation"]},
];

/* =========================
   STORAGE (Leitner + streak)
   ========================= */
const STORE_KEY = "quicklearn_v1";
function loadStore(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || null; }catch(e){ return null; }
}
function saveStore(obj){ localStorage.setItem(STORE_KEY, JSON.stringify(obj)); }

function todayStr(){
  const d = new Date();
  return d.toISOString().slice(0,10);
}
function initStore(){
  const s = loadStore();
  if(s) return s;
  // default: all cards start in box 1
  const boxes = {};
  CARDS.forEach(c => boxes[c.id] = 1);
  const state = { theme:"dark", boxes, lastPractice:null, streak:0, deck:"ALL", order:[], idx:0 };
  saveStore(state);
  return state;
}
let STATE = initStore();

/* =========================
   UI helpers
   ========================= */
const $ = (q)=>document.querySelector(q);
const $$ = (q)=>Array.from(document.querySelectorAll(q));

function setTheme(theme){
  document.documentElement.dataset.theme = theme === "light" ? "light" : "dark";
  STATE.theme = theme;
  saveStore(STATE);
}
setTheme(STATE.theme);

function setTab(tab){
  $$(".tab").forEach(b=>b.classList.toggle("active", b.dataset.tab===tab));
  ["overview","chapters","timeline","flashcards","quiz","progress"].forEach(t=>{
    const el = $("#tab-"+t);
    el.classList.toggle("hidden", t!==tab);
  });
}

/* =========================
   Build overview
   ========================= */
function buildAnchors(){
  const anchors = EVENTS.filter(e=>e.anchor).sort((a,b)=> String(a.year).localeCompare(String(b.year)));
  const byChap = {};
  anchors.forEach(e=>{
    byChap[e.chapter] ||= [];
    byChap[e.chapter].push(e);
  });
  const holder = $("#anchorList");
  holder.innerHTML = "";
  CHAPTERS.forEach(ch=>{
    const list = byChap[ch.id] || [];
    const card = document.createElement("div");
    card.className = "card";
    card.style.padding = "12px";
    card.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <b>${ch.title}</b>
        <span class="tag">${list.length} anchors</span>
      </div>
      <ul>${list.map(x=>`<li><span style="font-family:var(--mono); color:var(--accent)">${x.year}</span> ‚Äî ${x.title}</li>`).join("")}</ul>
    `;
    holder.appendChild(card);
  });
}

function buildCheatSheet(){
  const cheats = {
    EU: [
      "Nationalism = people feel they belong to one nation.",
      "French Revolution spreads citizenship + rights.",
      "Conservatives (1815 Vienna) try to stop revolutions.",
      "1830/1848 revolutions show liberal nationalism rising.",
      "Italy (1861) and Germany (1871) unify ‚Üí nation-states.",
    ],
    IN: [
      "Nationalism grows through movements + shared symbols.",
      "1919 repression (Rowlatt/Jallianwala) ‚Üí mass anger.",
      "Non‚ÄëCooperation (1920) = boycott British institutions.",
      "Civil Disobedience (1930) = break unjust laws (salt).",
      "Quit India (1942) = final mass push for freedom.",
    ],
    GW: [
      "Global world = trade + migration + capital connections.",
      "Colonialism + plantations changed world economy.",
      "Indentured labour moved workers across oceans (1800s).",
      "WWI (1914‚Äì18) disrupts trade and economies.",
      "Great Depression (1929) crashes demand worldwide.",
    ],
    AI: [
      "Industrialisation = factories + machines + new labour.",
      "Small producers survive by adapting and specialising.",
      "Railways/steamships expand markets.",
      "In India, cotton/jute industries grow; entrepreneurs rise.",
      "Workers face harsh conditions; unions/struggles emerge.",
    ],
    PC: [
      "Print makes ideas travel fast and cheap.",
      "Gutenberg (1450s) ‚Üí printing revolution.",
      "Print helps Reformation + Enlightenment + public opinion.",
      "In India, vernacular press + novels shape debates.",
      "Print supports nationalism by creating shared identity.",
    ]
  };

  const holder = $("#cheatSheet");
  holder.innerHTML = "";
  CHAPTERS.forEach(ch=>{
    const d = document.createElement("div");
    d.className = "card";
    d.style.padding = "12px";
    d.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <b>${ch.title}</b>
        <span class="tag">60 sec</span>
      </div>
      <ul>${(cheats[ch.id]||[]).map(x=>`<li>${x}</li>`).join("")}</ul>
    `;
    holder.appendChild(d);
  });
}

/* =========================
   Build chapters accordion
   ========================= */
function buildChapterFilter(){
  const s1 = $("#chapterFilter");
  const s2 = $("#timeFilter");
  const s3 = $("#deckSelect");
  const s4 = $("#quizFilter");
  [s1,s2,s4].forEach(sel=>{
    CHAPTERS.forEach(ch=>{
      const o = document.createElement("option");
      o.value = ch.id; o.textContent = ch.title;
      sel.appendChild(o);
    });
  });

  // decks
  s3.innerHTML = "";
  const all = document.createElement("option");
  all.value="ALL"; all.textContent="All Chapters (mixed)";
  s3.appendChild(all);
  CHAPTERS.forEach(ch=>{
    const o = document.createElement("option");
    o.value = ch.id; o.textContent = ch.title;
    s3.appendChild(o);
  });
  s3.value = STATE.deck || "ALL";
}

function chapterFacts(chId){
  const ev = EVENTS.filter(e=>e.chapter===chId);
  const anchors = ev.filter(e=>e.anchor);
  const people = [...new Set(ev.flatMap(e=>e.people||[]).filter(x=>x && x!=="‚Äî"))].slice(0,8);
  const places = [...new Set(ev.flatMap(e=>e.places||[]))].slice(0,10);
  return {ev, anchors, people, places};
}

function buildChapters(){
  const search = $("#chapterSearch").value.trim().toLowerCase();
  const filter = $("#chapterFilter").value;

  const holder = $("#chapterAccordions");
  holder.innerHTML = "";

  CHAPTERS.filter(ch=> filter==="ALL" ? true : ch.id===filter).forEach(ch=>{
    const facts = chapterFacts(ch.id);

    // 60 sec story (super condensed)
    const story = {
      EU:"Europe‚Äôs nationalism grows after the French Revolution. Conservatives try to stop it (1815 Vienna), but revolutions (1830/1848) keep returning. Finally, strong leaders unify Italy (1861) and Germany (1871), creating modern nation‚Äëstates.",
      IN:"Indian nationalism grows through shared symbols and mass movements. Repression in 1919 sparks anger. Non‚ÄëCooperation (1920) uses boycott; Civil Disobedience (1930) breaks unjust laws; Quit India (1942) becomes the final mass push.",
      GW:"The world becomes connected through trade, conquest, and migration. Plantations and colonial rule reshape economies. Indentured labour moves across oceans. WWI and the Great Depression disrupt global trade and cause suffering worldwide.",
      AI:"Industrialisation shifts production to factories and machines. Markets expand through transport. In India, handloom survives by adapting; factories grow in cotton/jute. Workers face harsh conditions, leading to struggles and new politics.",
      PC:"Print makes ideas spread quickly: Gutenberg‚Äôs press (1450s) transforms Europe. Print supports Reformation and Enlightenment. In India, vernacular press and novels shape social reform and nationalism by creating shared public opinion."
    }[ch.id];

    const matches = (text)=> (text||"").toLowerCase().includes(search);
    const visible =
      !search ||
      matches(ch.title) ||
      matches(story) ||
      facts.ev.some(e=> matches(e.title) || matches(e.detail) || (e.places||[]).some(p=>matches(p)) || (e.people||[]).some(p=>matches(p)));

    if(!visible) return;

    const det = document.createElement("details");
    det.open = false;
    det.innerHTML = `
      <summary>
        <span>${ch.title}</span>
        <span class="tag">${facts.anchors.length} anchors</span>
      </summary>
      <div class="two" style="margin-top:10px">
        <div>
          <div class="callout"><b>Big story (60 seconds):</b><br>${story}</div>
          <div class="divider"></div>
          <b>Anchor years (memorize these):</b>
          <ul>${facts.anchors.map(e=>`<li><span style="font-family:var(--mono); color:var(--accent)">${e.year}</span> ‚Äî ${e.title}</li>`).join("") || "<li class='muted'>‚Äî</li>"}</ul>
        </div>
        <div>
          <b>Key people:</b>
          <div class="row" style="margin-top:8px">${facts.people.map(p=>`<span class="tag">${p}</span>`).join("") || "<span class='muted'>‚Äî</span>"}</div>
          <div class="divider"></div>
          <b>Key places:</b>
          <div class="row" style="margin-top:8px">${facts.places.map(p=>`<span class="tag">${p}</span>`).join("") || "<span class='muted'>‚Äî</span>"}</div>
          <div class="divider"></div>
          <b>Exam-ready 3-line template:</b>
          <ul>
            <li><b>Cause/Context:</b> what problem led to it?</li>
            <li><b>Main Event:</b> what happened?</li>
            <li><b>Impact:</b> what changed?</li>
          </ul>
        </div>
      </div>
    `;
    holder.appendChild(det);
  });

  if(!holder.children.length){
    holder.innerHTML = `<div class="card"><h2>No matches</h2><div class="muted">Try a broader keyword.</div></div>`;
  }
}

/* =========================
   Build timeline
   ========================= */
function buildTimeline(){
  const filter = $("#timeFilter").value;
  const q = $("#timeSearch").value.trim().toLowerCase();
  const list = EVENTS
    .filter(e => filter==="ALL" ? true : e.chapter===filter)
    .filter(e => !q ? true :
      String(e.year).toLowerCase().includes(q) ||
      e.title.toLowerCase().includes(q) ||
      (e.detail||"").toLowerCase().includes(q) ||
      (e.places||[]).some(p=>p.toLowerCase().includes(q)) ||
      (e.people||[]).some(p=>p.toLowerCase().includes(q))
    )
    .sort((a,b)=> String(a.year).localeCompare(String(b.year), undefined, {numeric:true}));

  const strip = $("#timelineStrip");
  strip.innerHTML = "";
  list.forEach(e=>{
    const ch = CHAPTERS.find(x=>x.id===e.chapter)?.title || e.chapter;
    const el = document.createElement("div");
    el.className = "event";
    el.innerHTML = `
      <div class="year">${e.year} ${e.anchor ? `<span class="tag" style="margin-left:8px">Anchor</span>` : ""}</div>
      <div class="title">${e.title}</div>
      <div class="meta">${ch}</div>
      <div style="margin-top:8px; line-height:1.5">${e.detail}</div>
      <div class="meta" style="margin-top:10px">
        ${(e.places?.length? `üìç ${e.places.join(", ")}`:"")}
        ${(e.people?.filter(x=>x && x!=="‚Äî").length? `<br>üë§ ${e.people.filter(x=>x&&x!=="‚Äî").join(", ")}`:"")}
      </div>
    `;
    strip.appendChild(el);
  });
  if(!list.length){
    strip.innerHTML = `<div class="event"><div class="title">No events found</div><div class="meta">Try removing filters.</div></div>`;
  }
}

/* =========================
   Flashcards (Leitner)
   ========================= */
function cardsForDeck(deck){
  return CARDS.filter(c => deck==="ALL" ? true : c.chapter===deck);
}

function rebuildOrder(){
  // Weighted: prefer lower boxes
  const deck = $("#deckSelect").value;
  STATE.deck = deck;
  const pool = cardsForDeck(deck);

  const weighted = [];
  pool.forEach(c=>{
    const box = STATE.boxes[c.id] || 1;
    const w = (5 - box); // box1 more weight
    for(let i=0;i<w;i++) weighted.push(c.id);
  });

  // shuffle
  for(let i=weighted.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [weighted[i], weighted[j]] = [weighted[j], weighted[i]];
  }

  // de-duplicate while keeping order-ish
  const seen = new Set();
  const order = [];
  for(const id of weighted){
    if(!seen.has(id)){ seen.add(id); order.push(id); }
  }
  // fallback if something weird happens
  STATE.order = order.length ? order : pool.map(c=>c.id);
  STATE.idx = 0;
  saveStore(STATE);
  updateBoxesUI();
  renderFlashcard();
}

function currentCard(){
  const id = STATE.order[STATE.idx];
  return CARDS.find(c=>c.id===id) || CARDS[0];
}

function renderFlashcard(){
  const card = currentCard();
  if(!card) return;
  const deckName = $("#deckSelect").selectedOptions[0]?.textContent || "Deck";
  $("#fcMeta").textContent = `${deckName} ‚Ä¢ ${STATE.idx+1}/${STATE.order.length} ‚Ä¢ Box ${STATE.boxes[card.id]||1}`;
  $("#fcFront").textContent = card.front;
  $("#fcBack").textContent = card.back;
  const chips = [];
  chips.push(CHAPTERS.find(c=>c.id===card.chapter)?.title || card.chapter);
  (card.tags||[]).slice(0,5).forEach(t=>chips.push("#"+t));
  if(card.year) chips.push("üóì "+card.year);
  $("#fcChips").innerHTML = chips.map(x=>`<span>${x}</span>`).join("");
  $("#flashcard").classList.remove("revealed");
}

function nextCard(){
  STATE.idx = (STATE.idx + 1) % STATE.order.length;
  saveStore(STATE);
  renderFlashcard();
}

function rateCard(level){
  // update streak
  const today = todayStr();
  if(STATE.lastPractice !== today){
    // streak logic
    const last = STATE.lastPractice ? new Date(STATE.lastPractice) : null;
    const t = new Date(today);
    const diffDays = last ? Math.round((t-last)/(1000*60*60*24)) : null;
    if(diffDays === 1) STATE.streak = (STATE.streak||0) + 1;
    else STATE.streak = 1;
    STATE.lastPractice = today;
  }

  const card = currentCard();
  const cur = STATE.boxes[card.id] || 1;
  let nextBox = cur;

  if(level==="again") nextBox = 1;
  else if(level==="hard") nextBox = Math.max(1, cur); // keep
  else if(level==="good") nextBox = Math.min(4, cur+1);
  else if(level==="easy") nextBox = Math.min(4, cur+2);

  STATE.boxes[card.id] = nextBox;
  saveStore(STATE);
  updateBoxesUI();
  updateStreakUI();
  nextCard();
}

function updateBoxesUI(){
  const counts = {1:0,2:0,3:0,4:0};
  const deck = STATE.deck || "ALL";
  cardsForDeck(deck).forEach(c=>{
    counts[STATE.boxes[c.id]||1] += 1;
  });
  $("#box1").textContent = counts[1];
  $("#box2").textContent = counts[2];
  $("#box3").textContent = counts[3];
  $("#box4").textContent = counts[4];

  // progress page
  const allCards = CARDS.length;
  const mastered = Object.values(STATE.boxes).filter(x=>x===4).length;
  const weak = Object.values(STATE.boxes).filter(x=>(x||1)===1).length;
  $("#pTotal").textContent = allCards;
  $("#pMastered").textContent = mastered;
  $("#pWeak").textContent = weak;
}

function updateStreakUI(){
  $("#streak").textContent = STATE.streak || 0;
}

/* =========================
   Quiz (from cards)
   ========================= */
let QUIZ = [];
function makeQuiz(deck="ALL", n=10){
  const pool = cardsForDeck(deck);
  // build multiple-choice questions by using other card backs as distractors
  const shuffled = [...pool].sort(()=>Math.random()-0.5).slice(0, Math.min(n, pool.length));
  QUIZ = shuffled.map((c, idx)=>{
    const correct = c.back.split("\n")[0].trim(); // first line
    const others = pool.filter(x=>x.id!==c.id).sort(()=>Math.random()-0.5).slice(0,3).map(x=>x.back.split("\n")[0].trim());
    const options = [...others, correct].sort(()=>Math.random()-0.5);
    return {id:"q"+idx, cardId:c.id, prompt:c.front, options, correct};
  });
  renderQuiz();
}

function renderQuiz(){
  const area = $("#quizArea");
  area.innerHTML = "";
  QUIZ.forEach((q, i)=>{
    const box = document.createElement("div");
    box.className = "quizQ";
    box.innerHTML = `
      <div class="small">Q${i+1}</div>
      <div style="font-weight:700; margin-top:4px">${q.prompt}</div>
      <div id="${q.id}-opts"></div>
      <div class="small" id="${q.id}-fb" style="margin-top:8px"></div>
    `;
    area.appendChild(box);

    const opts = box.querySelector("#"+q.id+"-opts");
    q.options.forEach((opt, oi)=>{
      const d = document.createElement("div");
      d.className = "opt";
      d.textContent = opt;
      d.dataset.qid = q.id;
      d.dataset.opt = opt;
      d.addEventListener("click", ()=>{
        // single select
        $$("#"+q.id+"-opts .opt").forEach(x=>x.classList.remove("selected"));
        d.classList.add("selected");
        d.dataset.selected = "1";
      });
      opts.appendChild(d);
    });
  });
  $("#quizScore").textContent = `0/${QUIZ.length}`;
}

function gradeQuiz(){
  let score = 0;
  QUIZ.forEach(q=>{
    const selected = Array.from(document.querySelectorAll(`#${q.id}-opts .opt.selected`))[0];
    const fb = document.getElementById(q.id+"-fb");
    $$("#"+q.id+"-opts .opt").forEach(x=>{
      x.classList.remove("correct","wrong");
      if(x.textContent===q.correct) x.classList.add("correct");
    });
    if(selected){
      if(selected.textContent===q.correct){
        score += 1;
        fb.textContent = "‚úÖ Correct";
        fb.style.color = "var(--good)";
      }else{
        selected.classList.add("wrong");
        fb.textContent = "‚ùå Wrong ‚Äî review this flashcard next";
        fb.style.color = "var(--bad)";
        // push wrong one back to Box 1 to force review
        const cid = q.cardId;
        STATE.boxes[cid] = 1;
      }
    }else{
      fb.textContent = "‚ö†Ô∏è Not answered";
      fb.style.color = "var(--muted)";
    }
  });
  saveStore(STATE);
  updateBoxesUI();
  $("#quizScore").textContent = `${score}/${QUIZ.length}`;
}

/* =========================
   Wiring / events
   ========================= */
buildAnchors();
buildCheatSheet();
buildChapterFilter();
buildChapters();
buildTimeline();
updateBoxesUI();
updateStreakUI();

// tabs
$$(".tab").forEach(b=>b.addEventListener("click", ()=>setTab(b.dataset.tab)));

// theme
$("#themeBtn").addEventListener("click", ()=>{
  setTheme((STATE.theme||"dark")==="dark" ? "light" : "dark");
});

// reset
$("#resetBtn").addEventListener("click", ()=>{
  if(!confirm("Reset saved progress for flashcards/quiz?")) return;
  localStorage.removeItem(STORE_KEY);
  STATE = initStore();
  setTheme(STATE.theme);
  buildChapterFilter();
  rebuildOrder();
  updateBoxesUI();
  updateStreakUI();
  makeQuiz($("#quizFilter").value, 10);
});

// chapters search/filter
$("#chapterSearch").addEventListener("input", buildChapters);
$("#chapterFilter").addEventListener("change", buildChapters);

// timeline filter/search
$("#timeFilter").addEventListener("change", buildTimeline);
$("#timeSearch").addEventListener("input", buildTimeline);

// flashcards
$("#deckSelect").addEventListener("change", rebuildOrder);
$("#shuffleBtn").addEventListener("click", rebuildOrder);

const fcEl = $("#flashcard");
function toggleReveal(){ fcEl.classList.toggle("revealed"); }
fcEl.addEventListener("click", toggleReveal);
fcEl.addEventListener("keydown", (e)=>{
  if(e.key===" " || e.key==="Enter"){ e.preventDefault(); toggleReveal(); }
});

$("#rateAgain").addEventListener("click", ()=>rateCard("again"));
$("#rateHard").addEventListener("click", ()=>rateCard("hard"));
$("#rateGood").addEventListener("click", ()=>rateCard("good"));
$("#rateEasy").addEventListener("click", ()=>rateCard("easy"));

document.addEventListener("keydown", (e)=>{
  if($("#tab-flashcards").classList.contains("hidden")) return;
  if(e.key==="ArrowRight") nextCard();
  if(e.key.toLowerCase()==="a") rateCard("again");
  if(e.key.toLowerCase()==="h") rateCard("hard");
  if(e.key.toLowerCase()==="g") rateCard("good");
  if(e.key.toLowerCase()==="e") rateCard("easy");
});

// quiz
$("#newQuizBtn").addEventListener("click", ()=>makeQuiz($("#quizFilter").value, 10));
$("#submitQuizBtn").addEventListener("click", gradeQuiz);

// init flashcards order & quiz
rebuildOrder();
makeQuiz($("#quizFilter").value, 10);
</script>
</body>
</html>
